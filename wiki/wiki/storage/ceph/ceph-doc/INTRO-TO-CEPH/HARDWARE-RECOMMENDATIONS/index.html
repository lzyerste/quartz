<!doctype html><html lang=en><head><meta charset=utf-8><meta name=description content="HARDWARE RECOMMENDATIONS HARDWARE RECOMMENDATIONS Ceph was designed to run on commodity hardware, which makes building and maintaining petabyte-scale data clusters economically feasible."><title>HARDWARE_RECOMMENDATIONS_294f3f32fec34da5b953a38eb4627119</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" type=image/png href=https://lzyerste.github.io/quartz//icon.png><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Source+Sans+Pro:wght@400;600;700&family=Fira+Code:wght@400;700&display=swap" rel=stylesheet><link href=https://lzyerste.github.io/quartz/styles.48db36360688fe00f0a39f3cf1417c4b.min.css rel=stylesheet><script src=https://lzyerste.github.io/quartz/js/darkmode.46b07878b7f5d9e26ad7a3c40f8a0605.min.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css integrity=sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js integrity=sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script>
<script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],throwOnError:!1})})</script><script>const BASE_URL="https://lzyerste.github.io/quartz/",fetchData=Promise.all([fetch("https://lzyerste.github.io/quartz/indices/linkIndex.f477bbe572ee7d758ce303008c02fc00.min.json").then(e=>e.json()).then(e=>({index:e.index,links:e.links})),fetch("https://lzyerste.github.io/quartz/indices/contentIndex.2e9d747460ec7d5e4212cf55492683b4.min.json").then(e=>e.json())]).then(([{index:e,links:t},n])=>({index:e,links:t,content:n}))</script></head><script async src="https://www.googletagmanager.com/gtag/js?id=G-XYFD95KB4J"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XYFD95KB4J",{anonymize_ip:!1})}</script><body><div id=search-container><div id=search-space><input autocomplete=off id=search-bar name=search type=text aria-label=Search placeholder="Search for something..."><div id=results-container></div></div></div><script src=https://cdn.jsdelivr.net/npm/flexsearch@0.7.21/dist/flexsearch.bundle.js integrity="sha256-i3A0NZGkhsKjVMzFxv3ksk0DZh3aXqu0l49Bbh0MdjE=" crossorigin=anonymous defer></script>
<script defer src=https://lzyerste.github.io/quartz/js/search.7861a82db330f0a40935b7458fee3a02.min.js></script><div class=singlePage><header><h1 id=page-title><a href=https://lzyerste.github.io/quartz/>🪴 Quartz 3.2</a></h1><svg tabindex="0" id="search-icon" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search Icon</title><desc id="desc">Icon to open search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"/><circle cx="8" cy="8" r="7"/></g></svg><div class=spacer></div><div class=darkmode><input class=toggle id=darkmode-toggle type=checkbox tabindex=-1>
<label id=toggle-label-light for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="dayIcon" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35"><title>Light Mode</title><path d="M6 17.5C6 16.672 5.328 16 4.5 16h-3C.672 16 0 16.672.0 17.5S.672 19 1.5 19h3C5.328 19 6 18.328 6 17.5zM7.5 26c-.414.0-.789.168-1.061.439l-2 2C4.168 28.711 4 29.086 4 29.5 4 30.328 4.671 31 5.5 31c.414.0.789-.168 1.06-.44l2-2C8.832 28.289 9 27.914 9 27.5 9 26.672 8.329 26 7.5 26zm10-20C18.329 6 19 5.328 19 4.5v-3C19 .672 18.329.0 17.5.0S16 .672 16 1.5v3C16 5.328 16.671 6 17.5 6zm10 3c.414.0.789-.168 1.06-.439l2-2C30.832 6.289 31 5.914 31 5.5 31 4.672 30.329 4 29.5 4c-.414.0-.789.168-1.061.44l-2 2C26.168 6.711 26 7.086 26 7.5 26 8.328 26.671 9 27.5 9zM6.439 8.561C6.711 8.832 7.086 9 7.5 9 8.328 9 9 8.328 9 7.5c0-.414-.168-.789-.439-1.061l-2-2C6.289 4.168 5.914 4 5.5 4 4.672 4 4 4.672 4 5.5c0 .414.168.789.439 1.06l2 2.001zM33.5 16h-3c-.828.0-1.5.672-1.5 1.5s.672 1.5 1.5 1.5h3c.828.0 1.5-.672 1.5-1.5S34.328 16 33.5 16zM28.561 26.439C28.289 26.168 27.914 26 27.5 26c-.828.0-1.5.672-1.5 1.5.0.414.168.789.439 1.06l2 2C28.711 30.832 29.086 31 29.5 31c.828.0 1.5-.672 1.5-1.5.0-.414-.168-.789-.439-1.061l-2-2zM17.5 29c-.829.0-1.5.672-1.5 1.5v3c0 .828.671 1.5 1.5 1.5s1.5-.672 1.5-1.5v-3C19 29.672 18.329 29 17.5 29zm0-22C11.71 7 7 11.71 7 17.5S11.71 28 17.5 28 28 23.29 28 17.5 23.29 7 17.5 7zm0 18c-4.136.0-7.5-3.364-7.5-7.5s3.364-7.5 7.5-7.5 7.5 3.364 7.5 7.5S21.636 25 17.5 25z"/></svg></label><label id=toggle-label-dark for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="nightIcon" viewBox="0 0 100 100" style="enable-background='new 0 0 100 100'"><title>Dark Mode</title><path d="M96.76 66.458c-.853-.852-2.15-1.064-3.23-.534-6.063 2.991-12.858 4.571-19.655 4.571C62.022 70.495 50.88 65.88 42.5 57.5 29.043 44.043 25.658 23.536 34.076 6.47c.532-1.08.318-2.379-.534-3.23-.851-.852-2.15-1.064-3.23-.534-4.918 2.427-9.375 5.619-13.246 9.491-9.447 9.447-14.65 22.008-14.65 35.369.0 13.36 5.203 25.921 14.65 35.368s22.008 14.65 35.368 14.65c13.361.0 25.921-5.203 35.369-14.65 3.872-3.871 7.064-8.328 9.491-13.246C97.826 68.608 97.611 67.309 96.76 66.458z"/></svg></label></div></header><article><h1>HARDWARE_RECOMMENDATIONS_294f3f32fec34da5b953a38eb4627119</h1><p class=meta>Last updated May 5, 2022</p><ul class=tags></ul><aside class=mainTOC><details><summary>Table of Contents</summary><nav id=TableOfContents><ol><li><a href=#cpu>CPU</a></li><li><a href=#ram>RAM</a><ol><li><a href=#monitors-and-managers-ceph-mon-and-ceph-mgr>MONITORS AND MANAGERS (CEPH-MON AND CEPH-MGR)</a></li><li><a href=#metadata-servers-ceph-mds>METADATA SERVERS (CEPH-MDS)</a></li><li><a href=#osds-ceph-osd>OSDS (CEPH-OSD)</a></li></ol></li><li><a href=#memory>MEMORY</a></li><li><a href=#data-storage>DATA STORAGE</a><ol><li><a href=#hard-disk-drives>HARD DISK DRIVES</a></li><li><a href=#solid-state-drives>SOLID STATE DRIVES</a></li><li><a href=#controllers>CONTROLLERS</a></li><li><a href=#additional-considerations>ADDITIONAL CONSIDERATIONS</a></li></ol></li><li><a href=#networks>NETWORKS</a></li><li><a href=#failure-domains>FAILURE DOMAINS</a></li><li><a href=#minimum-hardware-recommendations>MINIMUM HARDWARE RECOMMENDATIONS</a></li></ol></nav></details></aside><h1 id=hardware-recommendations>HARDWARE RECOMMENDATIONS</h1><h1 id=hardware-recommendations-1>HARDWARE RECOMMENDATIONS</h1><p>Ceph was designed to run on commodity hardware, which makes building and maintaining petabyte-scale data clusters economically feasible. When planning out your cluster hardware, you will need to balance a number of considerations, including failure domains and potential performance issues. Hardware planning should include distributing Ceph daemons and other processes that use Ceph across many hosts. <code>Generally, we recommend running Ceph daemons of a specific type on a host configured for that type of daemon.</code> We recommend using other hosts for processes that utilize your data cluster (e.g., OpenStack, CloudStack, etc).</p><p><strong>Tip</strong></p><p>Check out the 
<a href=https://ceph.com/community/blog/ rel=noopener>Ceph blog</a> too.</p><h2 id=cpu>CPU</h2><p><code>Ceph metadata servers (MDS) dynamically redistribute their load, which is CPU intensive.</code> So your metadata servers should have significant processing power (e.g., quad core or better CPUs). Ceph OSDs run the 
<a href=https://docs.ceph.com/docs/master/glossary/#term-rados rel=noopener>RADOS</a> service, calculate data placement with 
<a href=https://docs.ceph.com/docs/master/glossary/#term-crush rel=noopener>CRUSH</a>, replicate data, and maintain their own copy of the cluster map. Therefore, <code>**OSDs should have a reasonable amount of processing power**</code> (e.g., dual core processors). <code>Monitors simply maintain a master copy of the cluster map, so they are not CPU intensive.</code> You must also consider whether the host machine will run CPU-intensive processes in addition to Ceph daemons. For example, if your hosts will run computing VMs (e.g., OpenStack Nova), you will need to ensure that these other processes leave sufficient processing power for Ceph daemons. We recommend running additional CPU-intensive processes on separate hosts.</p><h2 id=ram>RAM</h2><p>Generally, more RAM is better.</p><h3 id=monitors-and-managers-ceph-mon-and-ceph-mgr>MONITORS AND MANAGERS (CEPH-MON AND CEPH-MGR)</h3><p>Monitor and manager daemon memory usage generally scales with the size of the cluster. For small clusters, 1-2 GB is generally sufficient. For large clusters, you should provide more (5-10 GB). You may also want to consider tuning settings like <code>mon_osd_cache_size</code> or <code>rocksdb_cache_size</code>.</p><h3 id=metadata-servers-ceph-mds>METADATA SERVERS (CEPH-MDS)</h3><p>The metadata daemon memory utilization depends on how much memory its cache is configured to consume. We recommend 1 GB as a minimum for most systems. See <code>mds_cache_memory</code>.</p><h3 id=osds-ceph-osd>OSDS (CEPH-OSD)</h3><h2 id=memory>MEMORY</h2><p><strong><code>Bluestore</code></strong> uses its own memory to cache data rather than relying on the operating system page cache. In bluestore you can adjust the amount of memory the <code>OSD</code> attempts to consume with the <code>osd_memory_target</code> configuration option.</p><ul><li>Setting the osd_memory_target below 2GB is typically not recommended (it may fail to keep the memory that low and may also cause extremely slow performance.</li><li>Setting the memory target between 2GB and 4GB typically works but may result in degraded performance as metadata may be read from disk during IO unless the active data set is relatively small.</li><li><code>4GB is the current default osd_memory_target size</code> and was set that way to try and balance memory requirements and OSD performance for typical use cases.</li><li>Setting the osd_memory_target higher than 4GB may improve performance when there are many (small) objects or large (256GB/OSD or more) data sets being processed.</li></ul><p><strong>Important</strong></p><p><code>The OSD memory autotuning is “best effort”.</code> While the OSD may unmap memory to allow the kernel to reclaim it, there is no guarantee that the kernel will actually reclaim freed memory within any specific time frame. This is especially true in older versions of Ceph where <em>transparent huge pages</em> can prevent the kernel from reclaiming memory freed from fragmented huge pages. Modern versions of Ceph disable transparent huge pages at the application level to avoid this, though that still does not guarantee that the kernel will immediately reclaim unmapped memory. The OSD may still at times exceed it’s memory target. We recommend budgeting around 20% extra memory on your system to prevent OSDs from going OOM during temporary spikes or due to any delay in reclaiming freed pages by the kernel. That value may be more or less than needed depending on the exact configuration of the system.</p><p>When using the legacy FileStore backend, the page cache is used for caching data, so no tuning is normally needed, and the OSD memory consumption is generally related to the number of PGs per daemon in the system.</p><h2 id=data-storage>DATA STORAGE</h2><p>Plan your data storage configuration carefully. There are significant cost and performance tradeoffs to consider when planning for data storage. Simultaneous OS operations, and simultaneous request for read and write operations from multiple daemons against a single drive can slow performance considerably.</p><p><strong>Important</strong></p><p>Since <code>Ceph has to write all data to the journal before it can send an ACK</code> (for XFS at least), having the journal and OSD performance in balance is really important!</p><h3 id=hard-disk-drives>HARD DISK DRIVES</h3><p>OSDs should have plenty of hard disk drive space for object data. We recommend a minimum hard disk drive size of <code>1 terabyte</code>. Consider the cost-per-gigabyte advantage of larger disks. We recommend dividing the price of the hard disk drive by the number of gigabytes to arrive at a cost per gigabyte, because larger drives may have a significant impact on the cost-per-gigabyte. For example, a 1 terabyte hard disk priced at $75.00 has a cost of $0.07 per gigabyte (i.e., $75 / 1024 = 0.0732). By contrast, a 3 terabyte hard disk priced at $150.00 has a cost of $0.05 per gigabyte (i.e., $150 / 3072 = 0.0488). In the foregoing example, using the 1 terabyte disks would generally increase the cost per gigabyte by 40%–rendering your cluster substantially less cost efficient.</p><p><strong>Tip</strong></p><p><code>Running multiple OSDs on a single disk–irrespective of partitions–is **NOT** a good idea.</code></p><p><strong>Tip</strong></p><p><code>Running an OSD and a monitor or a metadata server on a single disk–irrespective of partitions–is **NOT** a good idea either.</code></p><p>Storage drives are subject to limitations on seek time, access time, read and write times, as well as total throughput. These physical limitations affect overall system performance–especially during recovery. <code>We recommend using a dedicated drive for the operating system and software</code>, and <code>one drive for each Ceph OSD Daemon</code> you run on the host. Most “slow OSD” issues arise due to running an operating system, multiple OSDs, and/or multiple journals on the same drive. Since the cost of troubleshooting performance issues on a small cluster likely exceeds the cost of the extra disk drives, you can optimize your cluster design planning by avoiding the temptation to overtax the OSD storage drives.</p><p>You may run multiple Ceph OSD Daemons per hard disk drive, but this will likely lead to resource contention and diminish the overall throughput. <code>You may store a journal and object data on the same drive</code>, but this may increase the time it takes to journal a write and ACK to the client. <code>Ceph must write to the journal before it can ACK the write.</code></p><p><em>Ceph best practices dictate that you should run operating systems, OSD data and OSD journals on separate drives.</em></p><h3 id=solid-state-drives>SOLID STATE DRIVES</h3><p>One opportunity for performance improvement is to use <code>solid-state drives (SSDs)</code> to reduce random access time and read latency while accelerating throughput. SSDs often cost more than 10x as much per gigabyte when compared to a hard disk drive, but SSDs often exhibit access times that are at least 100x faster than a hard disk drive.</p><p>SSDs do not have moving mechanical parts so they are not necessarily subject to the same types of limitations as hard disk drives. SSDs do have significant limitations though. When evaluating SSDs, it is important to consider the performance of <code>sequential reads and writes</code>. An SSD that has 400MB/s sequential write throughput may have much better performance than an SSD with 120MB/s of sequential write throughput when storing multiple journals for multiple OSDs.</p><p><strong>Important</strong></p><p>We recommend exploring the use of SSDs to improve performance. However, before making a significant investment in SSDs, we <strong>strongly recommend</strong> both reviewing the performance metrics of an SSD and testing the SSD in a test configuration to gauge performance.</p><p>Since SSDs have no moving mechanical parts, it makes sense to use them in the areas of Ceph that do not use a lot of storage space (e.g., journals). Relatively inexpensive SSDs may appeal to your sense of economy. Use caution. Acceptable IOPS are not enough when selecting an SSD for use with Ceph. There are a few important performance considerations for journals and SSDs:</p><ul><li><strong>Write-intensive semantics:</strong> Journaling involves write-intensive semantics, so you should ensure that the SSD you choose to deploy will perform equal to or better than a hard disk drive when writing data. Inexpensive SSDs may introduce write latency even as they accelerate access time, because sometimes high performance hard drives can write as fast or faster than some of the more economical SSDs available on the market!</li><li><strong>Sequential Writes:</strong> When you store multiple journals on an SSD you must consider the sequential write limitations of the SSD too, since they may be handling requests to write to multiple OSD journals simultaneously.</li><li><strong>Partition Alignment:</strong> A common problem with SSD performance is that people like to partition drives as a best practice, but they often overlook proper partition alignment with SSDs, which can cause SSDs to transfer data much more slowly. Ensure that SSD partitions are properly aligned.</li></ul><p>While SSDs are cost prohibitive for object storage, OSDs may see a significant performance improvement by storing an OSD’s journal on an SSD and the OSD’s object data on a separate hard disk drive. The <code>osd journal</code> configuration setting defaults to <code>/var/lib/ceph/osd/$cluster-$id/journal</code>. You can mount this path to an SSD or to an SSD partition so that it is not merely a file on the same disk as the object data.</p><p>One way Ceph accelerates CephFS file system performance is to segregate the storage of CephFS metadata from the storage of the CephFS file contents. Ceph provides a default <code>metadata</code> pool for CephFS metadata. You will never have to create a pool for CephFS metadata, but you can create a <em>CRUSH map</em> hierarchy for your CephFS metadata pool that points only to a host’s SSD storage media. See 
<a href=https://docs.ceph.com/docs/master/rados/operations/crush-map#placing-different-pools-on-different-osds rel=noopener>Mapping Pools to Different Types of OSDs</a> for details.</p><h3 id=controllers>CONTROLLERS</h3><p>Disk controllers also have a significant impact on write throughput. Carefully, consider your selection of disk controllers to ensure that they do not create a performance bottleneck.</p><p><strong>Tip</strong></p><p>The 
<a href=https://ceph.com/community/blog/ rel=noopener>Ceph blog</a> is often an excellent source of information on Ceph performance issues. See 
<a href=http://ceph.com/community/ceph-performance-part-1-disk-controller-write-throughput/ rel=noopener>Ceph Write Throughput 1</a> and 
<a href=http://ceph.com/community/ceph-performance-part-2-write-throughput-without-ssd-journals/ rel=noopener>Ceph Write Throughput 2</a> for additional details.</p><h3 id=additional-considerations>ADDITIONAL CONSIDERATIONS</h3><p>You may run multiple OSDs per host, but you should ensure that the sum of the total throughput of your OSD hard disks doesn’t exceed the <code>network bandwidth</code> required to service a client’s need to read or write data. You should also consider what percentage of the overall data the cluster stores on each host. If the percentage on a particular host is large and the host fails, it can lead to problems such as exceeding the <code>full ratio</code>, which causes Ceph to halt operations as a safety precaution that prevents data loss.</p><p>When you run multiple OSDs per host, you also need to ensure that the kernel is up to date. See 
<a href=https://docs.ceph.com/docs/master/start/os-recommendations rel=noopener>OS Recommendations</a> for notes on <code>glibc</code> and <code>syncfs(2)</code> to ensure that your hardware performs as expected when running multiple OSDs per host.</p><h2 id=networks>NETWORKS</h2><p>Consider starting with a 10Gbps+ network in your racks. Replicating 1TB of data across a 1Gbps network takes 3 hours, and 10TBs takes 30 hours! By contrast, with a 10Gbps network, the replication times would be 20 minutes and 1 hour respectively. In a petabyte-scale cluster, failure of an OSD disk should be an expectation, not an exception. System administrators will appreciate PGs recovering from a <code>degraded</code> state to an <code>active + clean</code> state as rapidly as possible, with price / performance tradeoffs taken into consideration. Additionally, some deployment tools employ <code>VLANs</code> to make hardware and network cabling more manageable. VLANs using 802.1q protocol require VLAN-capable NICs and Switches. The added hardware expense may be offset by the operational cost savings for network setup and maintenance. When using VLANs to handle VM traffic between the cluster and compute stacks (e.g., OpenStack, CloudStack, etc.), it is also worth considering using 10G Ethernet. Top-of-rack routers for each network also need to be able to communicate with spine routers that have even faster throughput–e.g., 40Gbps to 100Gbps.</p><p>Your server hardware should have a <code>Baseboard Management Controller (BMC)</code>. Administration and deployment tools may also use BMCs extensively, so consider the cost/benefit tradeoff of an out-of-band network for administration. Hypervisor SSH access, VM image uploads, OS image installs, management sockets, etc. can impose significant loads on a network. Running three networks may seem like overkill, but each traffic path represents a potential capacity, throughput and/or performance bottleneck that you should carefully consider before deploying a large scale data cluster.</p><h2 id=failure-domains>FAILURE DOMAINS</h2><p><code>A failure domain is any failure that prevents access to one or more OSDs.</code> That could be a stopped daemon on a host; a hard disk failure, an OS crash, a malfunctioning NIC, a failed power supply, a network outage, a power outage, and so forth. When planning out your hardware needs, you must balance the temptation to reduce costs by placing too many responsibilities into too few failure domains, and the added costs of isolating every potential failure domain.</p><h2 id=minimum-hardware-recommendations>MINIMUM HARDWARE RECOMMENDATIONS</h2><p>Ceph can run on inexpensive commodity hardware. Small production clusters and development clusters can run successfully with modest hardware.</p><p><img src=/assets/2022-05-02_11-14-34.png alt=HARDWARE%20RECOMMENDATIONS%20294f3f32fec34da5b953a38eb4627119/Untitled.png></p><p><strong>Tip</strong></p><p>If you are running an OSD with a single disk, create a partition for your volume storage that is separate from the partition containing the OS. Generally, we recommend separate disks for the OS and the volume storage.</p></article><hr><div class=page-end><div class=backlinks-container><h3>Backlinks</h3><ul class=backlinks><li>No backlinks found</li></ul></div></div><div id=contact_buttons><footer><p>Made by Jacky Zhao using <a href=https://github.com/jackyzha0/quartz>Quartz</a>, © 2022</p><ul><li><a href=/>Home</a></li><li><a href=https://twitter.com/_jzhao>Twitter</a></li><li><a href=https://github.com/jackyzha0>Github</a></li></ul></footer></div><script src=https://lzyerste.github.io/quartz/js/popover.e57188d2e4c06b0654e020b3a734bb62.min.js></script>
<script>initPopover("https://lzyerste.github.io/quartz")</script></div></body></html>