<!doctype html><html lang=en><head><meta charset=utf-8><meta name=description content="Manual Deployment MANUAL DEPLOYMENT All Ceph clusters require at least one monitor, and at least as many OSDs as copies of an object stored on the cluster."><title>Manual_Deployment</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" type=image/png href=https://lzyerste.github.io/quartz//icon.png><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Source+Sans+Pro:wght@400;600;700&family=Fira+Code:wght@400;700&display=swap" rel=stylesheet><link href=https://lzyerste.github.io/quartz/styles.48db36360688fe00f0a39f3cf1417c4b.min.css rel=stylesheet><script src=https://lzyerste.github.io/quartz/js/darkmode.46b07878b7f5d9e26ad7a3c40f8a0605.min.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css integrity=sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js integrity=sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script>
<script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],throwOnError:!1})})</script><script>const BASE_URL="https://lzyerste.github.io/quartz/",fetchData=Promise.all([fetch("https://lzyerste.github.io/quartz/indices/linkIndex.85c19f04f4842e6493b0b6c5f796012e.min.json").then(e=>e.json()).then(e=>({index:e.index,links:e.links})),fetch("https://lzyerste.github.io/quartz/indices/contentIndex.24e3e351b787ca8808d463bbc6abaf80.min.json").then(e=>e.json())]).then(([{index:e,links:t},n])=>({index:e,links:t,content:n}))</script></head><script async src="https://www.googletagmanager.com/gtag/js?id=G-XYFD95KB4J"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XYFD95KB4J",{anonymize_ip:!1})}</script><body><div id=search-container><div id=search-space><input autocomplete=off id=search-bar name=search type=text aria-label=Search placeholder="Search for something..."><div id=results-container></div></div></div><script src=https://cdn.jsdelivr.net/npm/flexsearch@0.7.21/dist/flexsearch.bundle.js integrity="sha256-i3A0NZGkhsKjVMzFxv3ksk0DZh3aXqu0l49Bbh0MdjE=" crossorigin=anonymous defer></script>
<script defer src=https://lzyerste.github.io/quartz/js/search.7861a82db330f0a40935b7458fee3a02.min.js></script><div class=singlePage><header><h1 id=page-title><a href=https://lzyerste.github.io/quartz/>ðŸª´ Quartz 3.2</a></h1><svg tabindex="0" id="search-icon" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search Icon</title><desc id="desc">Icon to open search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"/><circle cx="8" cy="8" r="7"/></g></svg><div class=spacer></div><div class=darkmode><input class=toggle id=darkmode-toggle type=checkbox tabindex=-1>
<label id=toggle-label-light for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="dayIcon" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35"><title>Light Mode</title><path d="M6 17.5C6 16.672 5.328 16 4.5 16h-3C.672 16 0 16.672.0 17.5S.672 19 1.5 19h3C5.328 19 6 18.328 6 17.5zM7.5 26c-.414.0-.789.168-1.061.439l-2 2C4.168 28.711 4 29.086 4 29.5 4 30.328 4.671 31 5.5 31c.414.0.789-.168 1.06-.44l2-2C8.832 28.289 9 27.914 9 27.5 9 26.672 8.329 26 7.5 26zm10-20C18.329 6 19 5.328 19 4.5v-3C19 .672 18.329.0 17.5.0S16 .672 16 1.5v3C16 5.328 16.671 6 17.5 6zm10 3c.414.0.789-.168 1.06-.439l2-2C30.832 6.289 31 5.914 31 5.5 31 4.672 30.329 4 29.5 4c-.414.0-.789.168-1.061.44l-2 2C26.168 6.711 26 7.086 26 7.5 26 8.328 26.671 9 27.5 9zM6.439 8.561C6.711 8.832 7.086 9 7.5 9 8.328 9 9 8.328 9 7.5c0-.414-.168-.789-.439-1.061l-2-2C6.289 4.168 5.914 4 5.5 4 4.672 4 4 4.672 4 5.5c0 .414.168.789.439 1.06l2 2.001zM33.5 16h-3c-.828.0-1.5.672-1.5 1.5s.672 1.5 1.5 1.5h3c.828.0 1.5-.672 1.5-1.5S34.328 16 33.5 16zM28.561 26.439C28.289 26.168 27.914 26 27.5 26c-.828.0-1.5.672-1.5 1.5.0.414.168.789.439 1.06l2 2C28.711 30.832 29.086 31 29.5 31c.828.0 1.5-.672 1.5-1.5.0-.414-.168-.789-.439-1.061l-2-2zM17.5 29c-.829.0-1.5.672-1.5 1.5v3c0 .828.671 1.5 1.5 1.5s1.5-.672 1.5-1.5v-3C19 29.672 18.329 29 17.5 29zm0-22C11.71 7 7 11.71 7 17.5S11.71 28 17.5 28 28 23.29 28 17.5 23.29 7 17.5 7zm0 18c-4.136.0-7.5-3.364-7.5-7.5s3.364-7.5 7.5-7.5 7.5 3.364 7.5 7.5S21.636 25 17.5 25z"/></svg></label><label id=toggle-label-dark for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="nightIcon" viewBox="0 0 100 100" style="enable-background='new 0 0 100 100'"><title>Dark Mode</title><path d="M96.76 66.458c-.853-.852-2.15-1.064-3.23-.534-6.063 2.991-12.858 4.571-19.655 4.571C62.022 70.495 50.88 65.88 42.5 57.5 29.043 44.043 25.658 23.536 34.076 6.47c.532-1.08.318-2.379-.534-3.23-.851-.852-2.15-1.064-3.23-.534-4.918 2.427-9.375 5.619-13.246 9.491-9.447 9.447-14.65 22.008-14.65 35.369.0 13.36 5.203 25.921 14.65 35.368s22.008 14.65 35.368 14.65c13.361.0 25.921-5.203 35.369-14.65 3.872-3.871 7.064-8.328 9.491-13.246C97.826 68.608 97.611 67.309 96.76 66.458z"/></svg></label></div></header><article><h1>Manual_Deployment</h1><p class=meta>Last updated June 28, 2022</p><ul class=tags></ul><aside class=mainTOC><details><summary>Table of Contents</summary><nav id=TableOfContents><ol><li><a href=#monitor-bootstrapping><strong>MONITOR BOOTSTRAPPING</strong></a></li><li><a href=#manager-daemon-configuration><strong>MANAGER DAEMON CONFIGURATION</strong></a></li><li><a href=#adding-osds><strong>ADDING OSDS</strong></a><ol><li><a href=#short-form><strong>SHORT FORM</strong></a></li><li><a href=#bluestore><strong>BLUESTORE</strong></a></li><li><a href=#filestore><strong>FILESTORE</strong></a></li><li><a href=#long-form><strong>LONG FORM</strong></a></li></ol></li><li><a href=#adding-mds><strong>ADDING MDS</strong></a></li><li><a href=#summary><strong>SUMMARY</strong></a></li></ol></nav></details></aside><h1 id=manual-deployment>Manual Deployment</h1><h1 id=manual-deployment-1><strong>MANUAL DEPLOYMENT</strong></h1><p>All Ceph clusters require <code>at least one monitor</code>, and <code>at least as many OSDs as copies of an object stored on the cluster</code>. Bootstrapping the initial monitor(s) is the first step in deploying a Ceph Storage Cluster. Monitor deployment also sets important criteria for the entire cluster, such as the number of replicas for pools, the number of placement groups per OSD, the heartbeat intervals, whether authentication is required, etc. Most of these values are set by default, so itâ€™s useful to know about them when setting up your cluster for production.</p><p>Following the same configuration as
<a href=https://docs.ceph.com/docs/master/install/ceph-deploy rel=noopener>Installation (ceph-deploy)</a>, we will set up a cluster with <code>node1</code> as the monitor node, and <code>node2</code> and <code>node3</code> for OSD nodes.</p><p><img src=https://docs.ceph.com/docs/master/_images/ditaa-9e7602f112d68831a1f69f6e1866f714672a7874.png alt=https://docs.ceph.com/docs/master/_images/ditaa-9e7602f112d68831a1f69f6e1866f714672a7874.png></p><h2 id=monitor-bootstrapping><strong>MONITOR BOOTSTRAPPING</strong></h2><p>Bootstrapping a monitor (a Ceph Storage Cluster, in theory) requires a number of things:</p><ul><li><p><strong><code>Unique Identifier</code>:</strong> The <code>fsid</code> is a unique identifier for the cluster, and stands for File System ID from the days when the Ceph Storage Cluster was principally for the Ceph File System. Ceph now supports native interfaces, block devices, and object storage gateway interfaces too, so <code>fsid</code> is a bit of a misnomer.</p></li><li><p><strong><code>Cluster Name</code>:</strong> Ceph clusters have a cluster name, which is a simple string without spaces. The default cluster name is <code>ceph</code>, but you may specify a different cluster name. Overriding the default cluster name is especially useful when you are working with multiple clusters and you need to clearly understand which cluster your are working with.</p><p>For example, when you run multiple clusters in a
<a href=https://docs.ceph.com/docs/master/radosgw/multisite/#multisite rel=noopener>multisite configuration</a>, the cluster name (e.g., <code>us-west</code>, <code>us-east</code>) identifies the cluster for the current CLI session. <strong>Note:</strong> To identify the cluster name on the command line interface, specify the Ceph configuration file with the cluster name (e.g., <code>ceph.conf</code>, <code>us-west.conf</code>, <code>us-east.conf</code>, etc.). Also see CLI usage (<code>ceph --cluster {cluster-name}</code>).</p></li><li><p><strong><code>Monitor Name</code>:</strong> Each monitor instance within a cluster has a unique name. In common practice, the Ceph Monitor name is the <code>host name</code> (we recommend one Ceph Monitor per host, and no commingling of Ceph OSD Daemons with Ceph Monitors). You may retrieve the short hostname with <code>hostname -s</code>.</p></li><li><p><strong><code>Monitor Map</code>:</strong> Bootstrapping the initial monitor(s) requires you to generate a monitor map. The monitor map requires the <code>fsid</code>, the cluster name (or uses the default), and at least one host name and its IP address.</p></li><li><p><strong><code>Monitor Keyring</code></strong>: Monitors communicate with each other via a secret key. You must generate a keyring with a monitor secret and provide it when bootstrapping the initial monitor(s).</p></li><li><p><strong><code>Administrator Keyring</code></strong>: To use the <code>ceph</code> CLI tools, you must have a <code>client.admin</code> user. So you must generate the admin user and keyring, and you must also add the <code>client.admin</code> user to the monitor keyring.</p></li></ul><p>The foregoing requirements do not imply the creation of a <code>Ceph Configuration file</code>. However, as a best practice, we recommend creating a Ceph configuration file and populating it with the <code>fsid</code>, the <code>mon initial members</code> and the <code>mon host</code> settings.</p><p>You can get and set all of the monitor settings at <code>runtime</code> as well. However, a Ceph Configuration file may contain only those settings that override the default values. When you add settings to a Ceph configuration file, these settings override the default settings. Maintaining those settings in a Ceph configuration file makes it easier to maintain your cluster.</p><p>The procedure is as follows:</p><ol><li><p>Log in to the initial monitor node(s):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>ssh {hostname}
</span></span></code></pre></td></tr></table></div></div><p>For example:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>ssh node1
</span></span></code></pre></td></tr></table></div></div></li><li><p>Ensure you have a directory for the Ceph configuration file. By default, Ceph uses <code>/etc/ceph</code>. When you install <code>ceph</code>, the installer will create the <code>/etc/ceph</code> directory automatically.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>ls /etc/ceph
</span></span></code></pre></td></tr></table></div></div><p><strong>Note:</strong> Deployment tools may remove this directory when purging a cluster (e.g., <code>ceph-deploy purgedata {node-name}</code>, <code>ceph-deploy purge {node-name}</code>).</p></li><li><p>Create a Ceph configuration file. By default, Ceph uses <code>ceph.conf</code>, where <code>ceph</code> reflects the cluster name.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>sudo vim /etc/ceph/ceph.conf
</span></span></code></pre></td></tr></table></div></div></li><li><p>Generate a unique ID (i.e., <code>fsid</code>) for your cluster.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>uuidgen
</span></span></code></pre></td></tr></table></div></div></li><li><p>Add the unique ID to your Ceph configuration file.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>fsid = {UUID}
</span></span></code></pre></td></tr></table></div></div><p>For example:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>fsid = a7f64266-0894-4f1e-a635-d0aeaca0e993
</span></span></code></pre></td></tr></table></div></div></li><li><p>Add the initial monitor(s) to your Ceph configuration file.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>mon initial members = {hostname}[,{hostname}]
</span></span></code></pre></td></tr></table></div></div><p>For example:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>mon initial members = node1
</span></span></code></pre></td></tr></table></div></div></li><li><p>Add the IP address(es) of the initial monitor(s) to your Ceph configuration file and save the file.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>mon host = {ip-address}[,{ip-address}]
</span></span></code></pre></td></tr></table></div></div><p>For example:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>mon host = 192.168.0.1
</span></span></code></pre></td></tr></table></div></div><p><strong>Note:</strong> You may use IPv6 addresses instead of IPv4 addresses, but you must set <code>ms bind ipv6</code> to <code>true</code>. See
<a href=https://docs.ceph.com/docs/master/rados/configuration/network-config-ref rel=noopener>Network Configuration Reference</a> for details about network configuration.</p></li><li><p>Create a keyring for your cluster and generate a monitor secret key.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>ceph-authtool --create-keyring /tmp/ceph.mon.keyring --gen-key -n mon. --cap mon &#39;allow *&#39;
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo -u ceph ceph-authtool --create-keyring /tmp/ceph.mon.keyring --gen-key -n mon. --cap mon <span class=s1>&#39;allow *&#39;</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>Generate an administrator keyring, generate a <code>client.admin</code> user and add the user to the keyring.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>sudo ceph-authtool --create-keyring /etc/ceph/ceph.client.admin.keyring --gen-key -n client.admin --cap mon &#39;allow *&#39; --cap osd &#39;allow *&#39; --cap mds &#39;allow *&#39; --cap mgr &#39;allow *&#39;
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo -u ceph ceph-authtool --create-keyring /etc/ceph/ceph.client.admin.keyring --gen-key -n client.admin --cap mon <span class=s1>&#39;allow *&#39;</span> --cap osd <span class=s1>&#39;allow *&#39;</span> --cap mds <span class=s1>&#39;allow *&#39;</span> --cap mgr <span class=s1>&#39;allow *&#39;</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>Generate a bootstrap-osd keyring, generate a <code>client.bootstrap-osd</code> user and add the user to the keyring.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>sudo ceph-authtool --create-keyring /var/lib/ceph/bootstrap-osd/ceph.keyring --gen-key -n client.bootstrap-osd --cap mon &#39;profile bootstrap-osd&#39; --cap mgr &#39;allow r&#39;
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo mkdir /var/lib/ceph
</span></span><span class=line><span class=cl>sudo chown -R ceph:ceph /var/lib/ceph
</span></span><span class=line><span class=cl>sudo -u ceph mkdir -p /var/lib/ceph/bootstrap-osd
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>sudo -u ceph ceph-authtool --create-keyring /var/lib/ceph/bootstrap-osd/ceph.keyring --gen-key -n client.bootstrap-osd --cap mon <span class=s1>&#39;profile bootstrap-osd&#39;</span> --cap mgr <span class=s1>&#39;allow r&#39;</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>Add the generated keys to the <code>ceph.mon.keyring</code>.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>sudo ceph-authtool /tmp/ceph.mon.keyring --import-keyring /etc/ceph/ceph.client.admin.keyring
</span></span><span class=line><span class=cl>sudo ceph-authtool /tmp/ceph.mon.keyring --import-keyring /var/lib/ceph/bootstrap-osd/ceph.keyring
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo -u ceph ceph-authtool /tmp/ceph.mon.keyring --import-keyring /etc/ceph/ceph.client.admin.keyring
</span></span><span class=line><span class=cl>sudo -u ceph ceph-authtool /tmp/ceph.mon.keyring --import-keyring /var/lib/ceph/bootstrap-osd/ceph.keyring
</span></span></code></pre></td></tr></table></div></div></li><li><p>Change the owner for <code>ceph.mon.keyring</code>.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>sudo chown ceph:ceph /tmp/ceph.mon.keyring
</span></span></code></pre></td></tr></table></div></div></li><li><p>Generate a monitor map using the hostname(s), host IP address(es) and the FSID. Save it as <code>/tmp/monmap</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>monmaptool --create --add {hostname} {ip-address} --fsid {uuid} /tmp/monmap
</span></span></code></pre></td></tr></table></div></div><p>For example:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>monmaptool --create --add node1 192.168.0.1 --fsid a7f64266-0894-4f1e-a635-d0aeaca0e993 /tmp/monmap
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo -u ceph monmaptool --create --add lzy-test-1 172.17.43.137 --fsid 6ddd8fc4-db86-40cd-bea0-945929f70996 /tmp/monmap
</span></span></code></pre></td></tr></table></div></div></li><li><p>Create a default data directory (or directories) on the monitor host(s).</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>sudo mkdir /var/lib/ceph/mon/{cluster-name}-{hostname}
</span></span></code></pre></td></tr></table></div></div><p>For example:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>sudo -u ceph mkdir /var/lib/ceph/mon/ceph-node1
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo -u ceph mkdir -p /var/lib/ceph/mon/ceph-lzy-test-1
</span></span></code></pre></td></tr></table></div></div><p>See
<a href=https://docs.ceph.com/docs/master/rados/configuration/mon-config-ref#data rel=noopener>Monitor Config Reference - Data</a> for details.</p></li><li><p>Populate the monitor daemon(s) with the monitor map and keyring.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>sudo -u ceph ceph-mon [--cluster {cluster-name}] --mkfs -i {hostname} --monmap /tmp/monmap --keyring /tmp/ceph.mon.keyring
</span></span></code></pre></td></tr></table></div></div><p>For example:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>sudo -u ceph ceph-mon --mkfs -i node1 --monmap /tmp/monmap --keyring /tmp/ceph.mon.keyring
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo -u ceph ceph-mon --mkfs -i lzy-test-1 --monmap /tmp/monmap --keyring /tmp/ceph.mon.keyring
</span></span></code></pre></td></tr></table></div></div></li><li><p>Consider settings for a Ceph configuration file. Common settings include the following:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[global]
</span></span><span class=line><span class=cl>fsid = {cluster-id}
</span></span><span class=line><span class=cl>mon initial members = {hostname}[, {hostname}]
</span></span><span class=line><span class=cl>mon host = {ip-address}[, {ip-address}]
</span></span><span class=line><span class=cl>public network = {network}[, {network}]
</span></span><span class=line><span class=cl>cluster network = {network}[, {network}]
</span></span><span class=line><span class=cl>auth cluster required = cephx
</span></span><span class=line><span class=cl>auth service required = cephx
</span></span><span class=line><span class=cl>auth client required = cephx
</span></span><span class=line><span class=cl>osd journal size = {n}
</span></span><span class=line><span class=cl>osd pool default size = {n}  # Write an object n times.
</span></span><span class=line><span class=cl>osd pool default min size = {n} # Allow writing n copies in a degraded state.
</span></span><span class=line><span class=cl>osd pool default pg num = {n}
</span></span><span class=line><span class=cl>osd pool default pgp num = {n}
</span></span><span class=line><span class=cl>osd crush chooseleaf type = {n}
</span></span></code></pre></td></tr></table></div></div><p>In the foregoing example, the <code>[global]</code> section of the configuration might look like this:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[global]
</span></span><span class=line><span class=cl>fsid = a7f64266-0894-4f1e-a635-d0aeaca0e993
</span></span><span class=line><span class=cl>mon initial members = node1
</span></span><span class=line><span class=cl>mon host = 192.168.0.1
</span></span><span class=line><span class=cl>public network = 192.168.0.0/24
</span></span><span class=line><span class=cl>auth cluster required = cephx
</span></span><span class=line><span class=cl>auth service required = cephx
</span></span><span class=line><span class=cl>auth client required = cephx
</span></span><span class=line><span class=cl>osd journal size = 1024
</span></span><span class=line><span class=cl>osd pool default size = 3
</span></span><span class=line><span class=cl>osd pool default min size = 2
</span></span><span class=line><span class=cl>osd pool default pg num = 333
</span></span><span class=line><span class=cl>osd pool default pgp num = 333
</span></span><span class=line><span class=cl>osd crush chooseleaf type = 1
</span></span></code></pre></td></tr></table></div></div></li><li><p>Start the monitor(s).</p><p>For most distributions, services are started via systemd now:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>sudo systemctl start ceph-mon@node1
</span></span></code></pre></td></tr></table></div></div><p>For older Debian/CentOS/RHEL, use sysvinit:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>sudo /etc/init.d/ceph start mon.node1
</span></span></code></pre></td></tr></table></div></div></li><li><p>Verify that the monitor is running.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>sudo ceph -s
</span></span></code></pre></td></tr></table></div></div><p>You should see output that the monitor you started is up and running, and you should see a health error indicating that placement groups are stuck inactive. It should look something like this:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>cluster:
</span></span><span class=line><span class=cl>  id: Â  Â  a7f64266-0894-4f1e-a635-d0aeaca0e993
</span></span><span class=line><span class=cl>  health: HEALTH_OK
</span></span><span class=line><span class=cl>â€‹
</span></span><span class=line><span class=cl>services:
</span></span><span class=line><span class=cl>  mon: 1 daemons, quorum node1
</span></span><span class=line><span class=cl>  mgr: node1(active)
</span></span><span class=line><span class=cl>  osd: 0 osds: 0 up, 0 in
</span></span><span class=line><span class=cl>â€‹
</span></span><span class=line><span class=cl>data:
</span></span><span class=line><span class=cl>  pools: Â  0 pools, 0 pgs
</span></span><span class=line><span class=cl>  objects: 0 objects, 0 bytes
</span></span><span class=line><span class=cl>  usage: Â  0 kB used, 0 kB / 0 kB avail
</span></span><span class=line><span class=cl>  pgs:
</span></span></code></pre></td></tr></table></div></div><p><strong>Note:</strong> Once you add OSDs and start them, the placement group health errors should disappear. See
<a href=https://docs.ceph.com/docs/master/install/manual-deployment/#adding-osds rel=noopener>Adding OSDs</a> for details.</p></li></ol><h2 id=manager-daemon-configuration><strong>MANAGER DAEMON CONFIGURATION</strong></h2><p>On each node where you run a ceph-mon daemon, you should also set up a ceph-mgr daemon.</p><p>See
<a href=https://docs.ceph.com/docs/master/mgr/administrator/#mgr-administrator-guide rel=noopener>ceph-mgr administratorâ€™s guide</a></p><h2 id=adding-osds><strong>ADDING OSDS</strong></h2><p>Once you have your initial monitor(s) running, you should add OSDs. Your cluster cannot reach an <code>active + clean</code> state until you have enough OSDs to handle the number of copies of an object (e.g., <code>osd pool default size = 2</code> requires at least two OSDs). After bootstrapping your monitor, your cluster has a default CRUSH map; however, the CRUSH map doesnâ€™t have any Ceph OSD Daemons mapped to a Ceph Node.</p><h3 id=short-form><strong>SHORT FORM</strong></h3><p>Ceph provides the <code>ceph-volume</code> utility, which can prepare a logical volume, disk, or partition for use with Ceph. The <code>ceph-volume</code> utility creates the OSD ID by incrementing the index. Additionally, <code>ceph-volume</code> will add the new OSD to the CRUSH map under the host for you. Execute <code>ceph-volume -h</code> for CLI details. The <code>ceph-volume</code> utility automates the steps of the
<a href=https://docs.ceph.com/docs/master/install/manual-deployment/#long-form rel=noopener>Long Form</a> below. To create the first two OSDs with the short form procedure, execute the following on <code>node2</code> and <code>node3</code>:</p><h3 id=bluestore><strong>BLUESTORE</strong></h3><ol><li><p>Create the OSD.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>ssh {node-name}
</span></span><span class=line><span class=cl>sudo ceph-volume lvm create --data {data-path}
</span></span></code></pre></td></tr></table></div></div><p>For example:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>ssh node1
</span></span><span class=line><span class=cl>sudo ceph-volume lvm create --data /dev/hdd1
</span></span></code></pre></td></tr></table></div></div></li></ol><p>Alternatively, the creation process can be split in two phases (prepare, and activate):</p><ol><li><p>Prepare the OSD.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>ssh {node-name}
</span></span><span class=line><span class=cl>sudo ceph-volume lvm prepare --data {data-path} {data-path}
</span></span></code></pre></td></tr></table></div></div><p>For example:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>ssh node1
</span></span><span class=line><span class=cl>sudo ceph-volume lvm prepare --data /dev/hdd1
</span></span></code></pre></td></tr></table></div></div><p>Once prepared, the <code>ID</code> and <code>FSID</code> of the prepared OSD are required for activation. These can be obtained by listing OSDs in the current server:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>sudo ceph-volume lvm list
</span></span></code></pre></td></tr></table></div></div></li><li><p>Activate the OSD:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>sudo ceph-volume lvm activate {ID} {FSID}
</span></span></code></pre></td></tr></table></div></div><p>For example:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>sudo ceph-volume lvm activate 0 a7f64266-0894-4f1e-a635-d0aeaca0e993
</span></span></code></pre></td></tr></table></div></div></li></ol><h3 id=filestore><strong>FILESTORE</strong></h3><ol><li><p>Create the OSD.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>ssh {node-name}
</span></span><span class=line><span class=cl>sudo ceph-volume lvm create --filestore --data {data-path} --journal {journal-path}
</span></span></code></pre></td></tr></table></div></div><p>For example:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>ssh node1
</span></span><span class=line><span class=cl>sudo ceph-volume lvm create --filestore --data /dev/hdd1 --journal /dev/hdd2
</span></span></code></pre></td></tr></table></div></div></li></ol><p>Alternatively, the creation process can be split in two phases (prepare, and activate):</p><ol><li><p>Prepare the OSD.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>ssh {node-name}
</span></span><span class=line><span class=cl>sudo ceph-volume lvm prepare --filestore --data {data-path} --journal {journal-path}
</span></span></code></pre></td></tr></table></div></div><p>For example:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>ssh node1
</span></span><span class=line><span class=cl>sudo ceph-volume lvm prepare --filestore --data /dev/hdd1 --journal /dev/hdd2
</span></span></code></pre></td></tr></table></div></div><p>Once prepared, the <code>ID</code> and <code>FSID</code> of the prepared OSD are required for activation. These can be obtained by listing OSDs in the current server:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>sudo ceph-volume lvm list
</span></span></code></pre></td></tr></table></div></div></li><li><p>Activate the OSD:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>sudo ceph-volume lvm activate --filestore {ID} {FSID}
</span></span></code></pre></td></tr></table></div></div><p>For example:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>sudo ceph-volume lvm activate --filestore 0 a7f64266-0894-4f1e-a635-d0aeaca0e993
</span></span></code></pre></td></tr></table></div></div></li></ol><h3 id=long-form><strong>LONG FORM</strong></h3><p>Without the benefit of any helper utilities, create an OSD and add it to the cluster and CRUSH map with the following procedure. To create the first two OSDs with the long form procedure, execute the following steps for each OSD.</p><p>Note</p><p>This procedure does not describe deployment on top of dm-crypt making use of the dm-crypt â€˜lockboxâ€™.</p><ol><li><p>Connect to the OSD host and become root.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>ssh {node-name}
</span></span><span class=line><span class=cl>sudo bash
</span></span></code></pre></td></tr></table></div></div></li><li><p>Generate a UUID for the OSD.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>UUID=$(uuidgen)
</span></span></code></pre></td></tr></table></div></div></li><li><p>Generate a cephx key for the OSD.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>OSD_SECRET=$(ceph-authtool --gen-print-key)
</span></span></code></pre></td></tr></table></div></div></li><li><p>Create the OSD. Note that an OSD ID can be provided as an additional argument to <code>ceph osd new</code> if you need to reuse a previously-destroyed OSD id. We assume that the <code>client.bootstrap-osd</code> key is present on the machine. You may alternatively execute this command as <code>client.admin</code> on a different host where that key is present.:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>ID=$(echo &#34;{\&#34;cephx_secret\&#34;: \&#34;$OSD_SECRET\&#34;}&#34; | \
</span></span><span class=line><span class=cl> Â  ceph osd new $UUID -i - \
</span></span><span class=line><span class=cl> Â  -n client.bootstrap-osd -k /var/lib/ceph/bootstrap-osd/ceph.keyring)
</span></span></code></pre></td></tr></table></div></div><p>It is also possible to include a <code>crush_device_class</code> property in the JSON to set an initial class other than the default (<code>ssd</code> or <code>hdd</code> based on the auto-detected device type).</p></li><li><p>Create the default directory on your new OSD.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>mkdir /var/lib/ceph/osd/ceph-$ID
</span></span></code></pre></td></tr></table></div></div></li><li><p>If the OSD is for a drive other than the OS drive, prepare it for use with Ceph, and mount it to the directory you just created.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>mkfs.xfs /dev/{DEV}
</span></span><span class=line><span class=cl>mount /dev/{DEV} /var/lib/ceph/osd/ceph-$ID
</span></span></code></pre></td></tr></table></div></div></li><li><p>Write the secret to the OSD keyring file.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>ceph-authtool --create-keyring /var/lib/ceph/osd/ceph-$ID/keyring \
</span></span><span class=line><span class=cl> Â  Â  --name osd.$ID --add-key $OSD_SECRET
</span></span></code></pre></td></tr></table></div></div></li><li><p>Initialize the OSD data directory.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>ceph-osd -i $ID --mkfs --osd-uuid $UUID
</span></span></code></pre></td></tr></table></div></div></li><li><p>Fix ownership.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>chown -R ceph:ceph /var/lib/ceph/osd/ceph-$ID
</span></span></code></pre></td></tr></table></div></div></li><li><p>After you add an OSD to Ceph, the OSD is in your configuration. However, it is not yet running. You must start your new OSD before it can begin receiving data.</p><p>For modern systemd distributions:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>systemctl enable ceph-osd@$ID
</span></span><span class=line><span class=cl>systemctl start ceph-osd@$ID
</span></span></code></pre></td></tr></table></div></div><p>For example:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>systemctl enable ceph-osd@12
</span></span><span class=line><span class=cl>systemctl start ceph-osd@12
</span></span></code></pre></td></tr></table></div></div></li></ol><h2 id=adding-mds><strong>ADDING MDS</strong></h2><p>In the below instructions, <code>{id}</code> is an arbitrary name, such as the hostname of the machine.</p><ol><li><p>Create the mds data directory.:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>mkdir -p /var/lib/ceph/mds/{cluster-name}-{id}
</span></span></code></pre></td></tr></table></div></div></li><li><p>Create a keyring.:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>ceph-authtool --create-keyring /var/lib/ceph/mds/{cluster-name}-{id}/keyring --gen-key -n mds.{id}
</span></span></code></pre></td></tr></table></div></div></li><li><p>Import the keyring and set caps.:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>ceph auth add mds.{id} osd &#34;allow rwx&#34; mds &#34;allow&#34; mon &#34;allow profile mds&#34; -i /var/lib/ceph/mds/{cluster}-{id}/keyring
</span></span></code></pre></td></tr></table></div></div></li><li><p>Add to ceph.conf.:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[mds.{id}]
</span></span><span class=line><span class=cl>host = {id}
</span></span></code></pre></td></tr></table></div></div></li><li><p>Start the daemon the manual way.:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>ceph-mds --cluster {cluster-name} -i {id} -m {mon-hostname}:{mon-port} [-f]
</span></span></code></pre></td></tr></table></div></div></li><li><p>Start the daemon the right way (using ceph.conf entry).:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>service ceph start
</span></span></code></pre></td></tr></table></div></div></li><li><p>If starting the daemon fails with this error:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>mds.-1.0 ERROR: failed to authenticate: (22) Invalid argument
</span></span></code></pre></td></tr></table></div></div><p>Then make sure you do not have a keyring set in ceph.conf in the global section; move it to the client section; or add a keyring setting specific to this mds daemon. And verify that you see the same key in the mds data directory and <code>ceph auth get mds.{id}</code> output.</p></li><li><p>Now you are ready to
<a href=https://docs.ceph.com/docs/master/cephfs/createfs rel=noopener>create a Ceph file system</a>.</p></li></ol><h2 id=summary><strong>SUMMARY</strong></h2><p>Once you have your monitor and two OSDs up and running, you can watch the placement groups peer by executing the following:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>ceph -w
</span></span></code></pre></td></tr></table></div></div><p>To view the tree, execute the following:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>ceph osd tree
</span></span></code></pre></td></tr></table></div></div><p>You should see output that looks something like this:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># id Â   weight  type name Â  Â  Â  up/down reweight
</span></span><span class=line><span class=cl>-1 Â  Â   2 Â  Â  Â  root default
</span></span><span class=line><span class=cl>-2 Â  Â   2 Â  Â  Â  Â  Â  Â  Â  host node1
</span></span><span class=line><span class=cl>0 Â  Â  Â  1 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  osd.0 Â  up Â  Â   1
</span></span><span class=line><span class=cl>-3 Â  Â   1 Â  Â  Â  Â  Â  Â  Â  host node2
</span></span><span class=line><span class=cl>1 Â  Â  Â  1 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  osd.1 Â  up Â  Â   1
</span></span></code></pre></td></tr></table></div></div><p>To add (or remove) additional monitors, see
<a href=https://docs.ceph.com/docs/master/rados/operations/add-or-rm-mons rel=noopener>Add/Remove Monitors</a>. To add (or remove) additional Ceph OSD Daemons, see
<a href=https://docs.ceph.com/docs/master/rados/operations/add-or-rm-osds rel=noopener>Add/Remove OSDs</a>.</p></article><hr><div class=page-end><div class=backlinks-container><h3>Backlinks</h3><ul class=backlinks><li>No backlinks found</li></ul></div></div><div id=contact_buttons><footer><p>Made by Jacky Zhao using <a href=https://github.com/jackyzha0/quartz>Quartz</a>, Â© 2022</p><ul><li><a href=/>Home</a></li><li><a href=https://twitter.com/_jzhao>Twitter</a></li><li><a href=https://github.com/jackyzha0>Github</a></li></ul></footer></div><script src=https://lzyerste.github.io/quartz/js/popover.e57188d2e4c06b0654e020b3a734bb62.min.js></script>
<script>initPopover("https://lzyerste.github.io/quartz")</script></div></body></html>