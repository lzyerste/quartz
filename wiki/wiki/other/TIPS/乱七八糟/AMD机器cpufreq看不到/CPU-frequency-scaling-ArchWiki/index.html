<!doctype html><html lang=en><head><meta charset=utf-8><meta name=description content="CPU frequency scaling - ArchWiki  https://wiki.archlinux.org/index.php/CPU_frequency_scaling
CPU frequency scaling enables the operating system to scale the CPU frequency up or down in order to save power."><title>CPU_frequency_scaling_-_ArchWiki</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" type=image/png href=https://lzyerste.github.io/quartz//icon.png><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Source+Sans+Pro:wght@400;600;700&family=Fira+Code:wght@400;700&display=swap" rel=stylesheet><link href=https://lzyerste.github.io/quartz/styles.48db36360688fe00f0a39f3cf1417c4b.min.css rel=stylesheet><script src=https://lzyerste.github.io/quartz/js/darkmode.46b07878b7f5d9e26ad7a3c40f8a0605.min.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css integrity=sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js integrity=sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script>
<script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],throwOnError:!1})})</script><script>const BASE_URL="https://lzyerste.github.io/quartz/",fetchData=Promise.all([fetch("https://lzyerste.github.io/quartz/indices/linkIndex.a91f5bd709fd8c42a131b4d50da41db8.min.json").then(e=>e.json()).then(e=>({index:e.index,links:e.links})),fetch("https://lzyerste.github.io/quartz/indices/contentIndex.a6a400d5304332d13f341e44b42a6ec5.min.json").then(e=>e.json())]).then(([{index:e,links:t},n])=>({index:e,links:t,content:n}))</script></head><script async src="https://www.googletagmanager.com/gtag/js?id=G-XYFD95KB4J"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XYFD95KB4J",{anonymize_ip:!1})}</script><body><div id=search-container><div id=search-space><input autocomplete=off id=search-bar name=search type=text aria-label=Search placeholder="Search for something..."><div id=results-container></div></div></div><script src=https://cdn.jsdelivr.net/npm/flexsearch@0.7.21/dist/flexsearch.bundle.js integrity="sha256-i3A0NZGkhsKjVMzFxv3ksk0DZh3aXqu0l49Bbh0MdjE=" crossorigin=anonymous defer></script>
<script defer src=https://lzyerste.github.io/quartz/js/search.7861a82db330f0a40935b7458fee3a02.min.js></script><div class=singlePage><header><h1 id=page-title><a href=https://lzyerste.github.io/quartz/>ðŸª´ Quartz 3.2</a></h1><svg tabindex="0" id="search-icon" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search Icon</title><desc id="desc">Icon to open search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"/><circle cx="8" cy="8" r="7"/></g></svg><div class=spacer></div><div class=darkmode><input class=toggle id=darkmode-toggle type=checkbox tabindex=-1>
<label id=toggle-label-light for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="dayIcon" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35"><title>Light Mode</title><path d="M6 17.5C6 16.672 5.328 16 4.5 16h-3C.672 16 0 16.672.0 17.5S.672 19 1.5 19h3C5.328 19 6 18.328 6 17.5zM7.5 26c-.414.0-.789.168-1.061.439l-2 2C4.168 28.711 4 29.086 4 29.5 4 30.328 4.671 31 5.5 31c.414.0.789-.168 1.06-.44l2-2C8.832 28.289 9 27.914 9 27.5 9 26.672 8.329 26 7.5 26zm10-20C18.329 6 19 5.328 19 4.5v-3C19 .672 18.329.0 17.5.0S16 .672 16 1.5v3C16 5.328 16.671 6 17.5 6zm10 3c.414.0.789-.168 1.06-.439l2-2C30.832 6.289 31 5.914 31 5.5 31 4.672 30.329 4 29.5 4c-.414.0-.789.168-1.061.44l-2 2C26.168 6.711 26 7.086 26 7.5 26 8.328 26.671 9 27.5 9zM6.439 8.561C6.711 8.832 7.086 9 7.5 9 8.328 9 9 8.328 9 7.5c0-.414-.168-.789-.439-1.061l-2-2C6.289 4.168 5.914 4 5.5 4 4.672 4 4 4.672 4 5.5c0 .414.168.789.439 1.06l2 2.001zM33.5 16h-3c-.828.0-1.5.672-1.5 1.5s.672 1.5 1.5 1.5h3c.828.0 1.5-.672 1.5-1.5S34.328 16 33.5 16zM28.561 26.439C28.289 26.168 27.914 26 27.5 26c-.828.0-1.5.672-1.5 1.5.0.414.168.789.439 1.06l2 2C28.711 30.832 29.086 31 29.5 31c.828.0 1.5-.672 1.5-1.5.0-.414-.168-.789-.439-1.061l-2-2zM17.5 29c-.829.0-1.5.672-1.5 1.5v3c0 .828.671 1.5 1.5 1.5s1.5-.672 1.5-1.5v-3C19 29.672 18.329 29 17.5 29zm0-22C11.71 7 7 11.71 7 17.5S11.71 28 17.5 28 28 23.29 28 17.5 23.29 7 17.5 7zm0 18c-4.136.0-7.5-3.364-7.5-7.5s3.364-7.5 7.5-7.5 7.5 3.364 7.5 7.5S21.636 25 17.5 25z"/></svg></label><label id=toggle-label-dark for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="nightIcon" viewBox="0 0 100 100" style="enable-background='new 0 0 100 100'"><title>Dark Mode</title><path d="M96.76 66.458c-.853-.852-2.15-1.064-3.23-.534-6.063 2.991-12.858 4.571-19.655 4.571C62.022 70.495 50.88 65.88 42.5 57.5 29.043 44.043 25.658 23.536 34.076 6.47c.532-1.08.318-2.379-.534-3.23-.851-.852-2.15-1.064-3.23-.534-4.918 2.427-9.375 5.619-13.246 9.491-9.447 9.447-14.65 22.008-14.65 35.369.0 13.36 5.203 25.921 14.65 35.368s22.008 14.65 35.368 14.65c13.361.0 25.921-5.203 35.369-14.65 3.872-3.871 7.064-8.328 9.491-13.246C97.826 68.608 97.611 67.309 96.76 66.458z"/></svg></label></div></header><article><h1>CPU_frequency_scaling_-_ArchWiki</h1><p class=meta>Last updated Unknown</p><ul class=tags></ul><aside class=mainTOC><details><summary>Table of Contents</summary><nav id=TableOfContents><ol><li><a href=#userspace-tools>Userspace tools</a><ol><li><a href=#i7z>i7z</a></li><li><a href=#cpupower>cpupower</a></li><li><a href=#cpupower-gui>cpupower-gui</a></li></ol></li><li><a href=#cpu-frequency-driver>CPU frequency driver</a><ol><li><a href=#setting-maximum-and-minimum-frequencies>Setting maximum and minimum frequencies</a></li><li><a href=#x86_energy_perf_policy>x86_energy_perf_policy</a></li></ol></li><li><a href=#scaling-governors>Scaling governors</a><ol><li><a href=#tuning-the-ondemand-governor>Tuning the ondemand governor</a></li></ol></li><li><a href=#interaction-with-acpi-events>Interaction with ACPI events</a></li><li><a href=#privilege-granting-under-gnome>Privilege granting under GNOME</a></li><li><a href=#troubleshooting>Troubleshooting</a></li><li><a href=#see-also>See also</a></li></ol></nav></details></aside><h1 id=cpu-frequency-scaling---archwiki>CPU frequency scaling - ArchWiki</h1><p><a href=https://wiki.archlinux.org/index.php/CPU_frequency_scaling rel=noopener>https://wiki.archlinux.org/index.php/CPU_frequency_scaling</a></p><p>CPU frequency scaling enables the operating system to scale the CPU frequency up or down in order to save power. CPU frequencies can be scaled automatically depending on the system load, in response to ACPI events, or manually by userspace programs.</p><p>CPU frequency scaling is implemented in the Linux kernel, the infrastructure is called cpufreq. Since kernel 3.4 the necessary modules are loaded automatically and the recommended
<a href=https://wiki.archlinux.org/index.php/CPU_frequency_scaling rel=noopener>ondemand governor</a> is enabled by default. However, userspace tools like
<a href=https://wiki.archlinux.org/index.php/CPU_frequency_scaling rel=noopener>cpupower</a>,
<a href=https://wiki.archlinux.org/index.php/Acpid rel=noopener>acpid</a>,
<a href=https://wiki.archlinux.org/index.php/Laptop_Mode_Tools rel=noopener>Laptop Mode Tools</a>, or GUI tools provided for your desktop environment, may still be used for advanced configuration.</p><h2 id=userspace-tools>Userspace tools</h2><p><a href="https://www.archlinux.org/packages/?name=thermald" rel=noopener>thermald</a> is a Linux daemon used to prevent the overheating of platforms. This daemon monitors temperature and applies compensation using available cooling methods.</p><p>By default, it monitors CPU temperature using available CPU digital temperature sensors and maintains CPU temperature under control, before HW takes aggressive correction action. If there is a skin temperature sensor in thermal sysfs, then it tries to keep skin temperature under 45C.</p><p>The associated systemd unit is <code>thermald.service</code>, which should be
<a href=https://wiki.archlinux.org/index.php/Start rel=noopener>started</a> and
<a href=https://wiki.archlinux.org/index.php/Enable rel=noopener>enabled</a>.</p><h3 id=i7z>i7z</h3><p><a href="https://www.archlinux.org/packages/?name=i7z" rel=noopener>i7z</a> is an i7 (and now i3, i5) CPU reporting tool for Linux. It can be launched from a Terminal with the command <code>i7z</code> or as GUI with <code>i7z-gui</code>.</p><h3 id=cpupower>cpupower</h3><p><a href="https://www.archlinux.org/packages/?name=cpupower" rel=noopener>cpupower</a> is a set of userspace utilities designed to assist with CPU frequency scaling. The package is not required to use scaling, but is highly recommended because it provides useful command-line utilities and a
<a href=https://wiki.archlinux.org/index.php/Systemd rel=noopener>systemd</a> service to change the governor at boot.</p><p>The configuration file for cpupower is located in <code>/etc/default/cpupower</code>. This configuration file is read by a bash script in <code>/usr/lib/systemd/scripts/cpupower</code> which is activated by systemd with <code>cpupower.service</code>. You may want to
<a href=https://wiki.archlinux.org/index.php/Enable rel=noopener>enable</a> <code>cpupower.service</code> to start at boot.</p><h3 id=cpupower-gui>cpupower-gui</h3><p><a href=https://aur.archlinux.org/packages/cpupower-gui/ rel=noopener>cpupower-gui</a>AUR is a graphical utility designed to assist with CPU frequency scaling. The GUI is based on
<a href=https://wiki.archlinux.org/index.php/GTK rel=noopener>GTK</a> and is meant to provide the same options as cpupower. cpupower-gui can change the maximum/minimum CPU frequency and governor for each core. The application handles privilege granting through
<a href=https://wiki.archlinux.org/index.php/Polkit rel=noopener>polkit</a> and allows any logged-in user in the <code>wheel</code>
<a href=https://wiki.archlinux.org/index.php/User_group rel=noopener>user group</a> to change the frequency and governor.</p><h2 id=cpu-frequency-driver>CPU frequency driver</h2><p><strong>Note:</strong></p><ul><li>The native CPU module is loaded automatically.</li><li>The <code>pstate</code> power scaling driver is used automatically for modern Intel CPUs instead of the other drivers below. This driver takes priority over other drivers and is built-in as opposed to being a module. This driver is currently automatically used for Sandy Bridge and newer CPUs. If you encounter a problem while using this driver, add <code>intel_pstate=disable</code> to your kernel line. You can use the same user space utilities with this driver, <strong>but cannot control it</strong>.</li><li>Even P State behavior mentioned above can be influenced with <code>/sys/devices/system/cpu/intel_pstate</code>, e.g. Intel Turbo Boost can be deactivated with <code>echo 1 > /sys/devices/system/cpu/intel_pstate/no_turbo</code> as the root user for keeping CPU-Temperatures low.</li><li>Additional control for modern Intel CPUs is available with the
<a href=https://01.org/linux-thermal-daemon rel=noopener>Linux Thermal Daemon</a> (available as
<a href="https://www.archlinux.org/packages/?name=thermald" rel=noopener>thermald</a>), which proactively controls thermal using P-states, T-states, and the Intel power clamp driver. thermald can also be used for older Intel CPUs. If the latest drivers are not available, then the daemon will revert to x86 model specific registers and the Linux â€˜cpufreq subsystemâ€™ to control system cooling.</li></ul><p>cpupower requires modules to know the limits of the native CPU:</p><p><a rel=noopener class="internal-link broken" data-src=assets/Untitled%20Database%20947854b40d78462995c4b4134afc01d3.csv>Untitled</a></p><p>To see a full list of available modules, run:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ ls /usr/lib/modules/$(uname -r)/kernel/drivers/cpufreq/
</span></span></code></pre></td></tr></table></div></div><p>Load the appropriate module (see
<a href=https://wiki.archlinux.org/index.php/Kernel_modules rel=noopener>Kernel modules</a> for details). Once the appropriate cpufreq driver is loaded, detailed information about the CPU(s) can be displayed by running</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ cpupower frequency-info
</span></span></code></pre></td></tr></table></div></div><h3 id=setting-maximum-and-minimum-frequencies>Setting maximum and minimum frequencies</h3><p>In some cases, it may be necessary to manually set maximum and minimum frequencies.</p><p>To set the maximum clock frequency (<code>clock_freq</code> is a clock frequency with units: GHz, MHz):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># cpupower frequency-set -u clock_freq
</span></span></code></pre></td></tr></table></div></div><p>To set the minimum clock frequency:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># cpupower frequency-set -d clock_freq
</span></span></code></pre></td></tr></table></div></div><p>To set the CPU to run at a specified frequency:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># cpupower frequency-set -f clock_freq
</span></span></code></pre></td></tr></table></div></div><p><strong>Note:</strong></p><ul><li>To adjust for only a single CPU core, append <code>c core_number</code>.</li><li>The governor, maximum and minimum frequencies can be set in <code>/etc/default/cpupower</code>.</li></ul><p>Alternatively, you can set the frequency manually:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># echo value &gt; /sys/devices/system/cpu/cpu*/cpufreq/scaling_max_freq
</span></span></code></pre></td></tr></table></div></div><p>The available values can be found in <code>/sys/devices/system/cpu/cpu*/cpufreq/scaling_available_frequencies</code> or similar.
<a href=https://software.intel.com/sites/default/files/comment/1716807/how-to-change-frequency-on-linux-pub.txt rel=noopener>1</a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># echo 1 &gt; /sys/devices/system/cpu/intel_pstate/no_turbo
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># echo 0 &gt; /sys/devices/system/cpu/cpufreq/boost
</span></span></code></pre></td></tr></table></div></div><h3 id=x86_energy_perf_policy>x86_energy_perf_policy</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># x86_energy_perf_policy --turbo-enable 0
</span></span></code></pre></td></tr></table></div></div><h2 id=scaling-governors>Scaling governors</h2><p>Governors (see table below) are power schemes for the CPU. Only one may be active at a time. For details, see the
<a href=https://www.kernel.org/doc/Documentation/cpu-freq/governors.txt rel=noopener>kernel documentation</a> in the kernel source.</p><p><a rel=noopener class="internal-link broken" data-src=assets/Untitled%20Database%20ca3782b1740243f9b62321d60081e268.csv>Untitled</a></p><p>Depending on the scaling driver, one of these governors will be loaded by default:</p><ul><li><code>ondemand</code> for AMD and older Intel CPU.</li><li><code>powersave</code> for Intel CPUs using the <code>intel_pstate</code> driver (Sandy Bridge and newer).</li></ul><p><strong>Note:</strong> The <code>intel_pstate</code> driver supports only the performance and powersave governors, but they both provide dynamic scaling. The performance governor
<a href="http://www.phoronix.com/scan.php?page=news_item&px=MTM3NDQ" rel=noopener>should give better power saving functionality than the old ondemand governor</a>.</p><p><strong>Warning:</strong> Use CPU monitoring tools (for temperatures, voltage, etc.) when changing the default governor.</p><p>To activate a particular governor, run:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># cpupower frequency-set -g governor
</span></span></code></pre></td></tr></table></div></div><p><strong>Note:</strong></p><ul><li>To adjust for only a single CPU core, append <code>c core_number</code> to the command above.</li><li>Activating a governor requires that specific
<a href=https://wiki.archlinux.org/index.php/Kernel_module rel=noopener>kernel module</a> (named <code>cpufreq_governor</code>) is loaded. As of kernel 3.4, these modules are loaded automatically.</li></ul><p>Alternatively, you can activate a governor on every available CPU manually:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># echo governor &gt; /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor
</span></span></code></pre></td></tr></table></div></div><p>where <code>governor</code> is the name of the governor, mentioned in the above table, that you want to activate.</p><p><strong>Tip:</strong> To monitor cpu speed in real time, run:</p><h3 id=tuning-the-ondemand-governor>Tuning the ondemand governor</h3><p>To set the threshold for stepping up to another frequency:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># echo -n percent &gt; /sys/devices/system/cpu/cpufreq/&lt;governor&gt;/up_threshold
</span></span></code></pre></td></tr></table></div></div><p>To set the threshold for stepping down to another frequency:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># echo -n percent &gt; /sys/devices/system/cpu/cpufreq/&lt;governor&gt;/down_threshold
</span></span></code></pre></td></tr></table></div></div><p>The sampling rate determines how frequently the governor checks to tune the CPU. <code>sampling_down_factor</code> is a tunable that multiplies the sampling rate when the CPU is at its highest clock frequency thereby delaying load evaluation and improving performance. Allowed values for <code>sampling_down_factor</code> are 1 to 100000. This tunable has no effect on behavior at lower CPU frequencies/loads.</p><p>To read the value (default = 1), run:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ cat /sys/devices/system/cpu/cpufreq/ondemand/sampling_down_factor
</span></span></code></pre></td></tr></table></div></div><p>To set the value, run:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># echo -n value &gt; /sys/devices/system/cpu/cpufreq/ondemand/sampling_down_factor
</span></span></code></pre></td></tr></table></div></div><p>To have the desired scaling enabled at boot,
<a href=https://wiki.archlinux.org/index.php/Kernel_modules rel=noopener>kernel module options</a> and
<a href=https://wiki.archlinux.org/index.php/Systemd-tmpfiles rel=noopener>systemd-tmpfiles</a> are regular methods.</p><p>For example, changing the up_threshold to 10:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>/etc/tmpfiles.d/ondemand.conf
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>w- /sys/devices/system/cpu/cpufreq/ondemand/up_threshold - - - - 10
</span></span></code></pre></td></tr></table></div></div><p>However, as noted in
<a href=https://wiki.archlinux.org/index.php/Systemd-tmpfiles rel=noopener>systemd-tmpfiles</a>, in some cases race conditions may exist and one can use
<a href=https://wiki.archlinux.org/index.php/Udev rel=noopener>udev</a> to avoid them.</p><p>For example, to set the scaling governor of the CPU core <code>0</code> to performance while the scaling driver is <code>acpi_cpufreq</code>, create the following udev rule:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>/etc/udev/rules.d/50-scaling-governor.rules
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>SUBSYSTEM==&#34;module&#34;, ACTION==&#34;add&#34;, KERNEL==&#34;acpi_cpufreq&#34;, RUN+=&#34;/bin/sh -c &#39;echo performance &gt; /sys/devices/system/cpu/cpufreq/policy0/scaling_governor&#39;&#34;
</span></span></code></pre></td></tr></table></div></div><p>To have the rule already applied in the initramfs, follow the example at
<a href=https://wiki.archlinux.org/index.php/Udev rel=noopener>udev#Debug output</a>.</p><h2 id=interaction-with-acpi-events>Interaction with ACPI events</h2><p>Users may configure scaling governors to switch automatically based on different ACPI events such as connecting the AC adapter or closing a laptop lid. A quick example is given below, however it may be worth reading full article on
<a href=https://wiki.archlinux.org/index.php/Acpid rel=noopener>acpid</a>.</p><p>Events are defined in <code>/etc/acpi/handler.sh</code>. If the
<a href="https://www.archlinux.org/packages/?name=acpid" rel=noopener>acpid</a> package is installed, the file should already exist and be executable. For example, to change the scaling governor from <code>performance</code> to <code>conservative</code> when the AC adapter is disconnected and change it back if reconnected:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>/etc/acpi/handler.sh
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[...]
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ac_adapter)
</span></span><span class=line><span class=cl>    case &#34;$2&#34; in
</span></span><span class=line><span class=cl>        AC*)
</span></span><span class=line><span class=cl>            case &#34;$4&#34; in
</span></span><span class=line><span class=cl>                00000000)
</span></span><span class=line><span class=cl>                    echo &#34;conservative&#34; &gt;/sys/devices/system/cpu/cpu0/cpufreq/scaling_governor    
</span></span><span class=line><span class=cl>                    echo -n $minspeed &gt;$setspeed
</span></span><span class=line><span class=cl>                    #/etc/laptop-mode/laptop-mode start
</span></span><span class=line><span class=cl>                ;;
</span></span><span class=line><span class=cl>                00000001)
</span></span><span class=line><span class=cl>                    echo &#34;performance&#34; &gt;/sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
</span></span><span class=line><span class=cl>                    echo -n $maxspeed &gt;$setspeed
</span></span><span class=line><span class=cl>                    #/etc/laptop-mode/laptop-mode stop
</span></span><span class=line><span class=cl>                ;;
</span></span><span class=line><span class=cl>            esac
</span></span><span class=line><span class=cl>        ;;
</span></span><span class=line><span class=cl>        *) logger &#34;ACPI action undefined: $2&#34; ;;
</span></span><span class=line><span class=cl>    esac
</span></span><span class=line><span class=cl>;;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[...]
</span></span></code></pre></td></tr></table></div></div><h2 id=privilege-granting-under-gnome>Privilege granting under GNOME</h2><p><strong>Note:</strong> systemd introduced logind which handles consolekit and policykit actions. The following code below does not work. With logind, simply edit in the file <code>/usr/share/polkit-1/actions/org.gnome.cpufreqselector.policy</code> the elements according to your needs and the polkit manual
<a href=https://www.freedesktop.org/software/polkit/docs/latest/polkit.8.html rel=noopener>4</a>.</p><p><a href=https://wiki.archlinux.org/index.php/GNOME rel=noopener>GNOME</a> has a nice applet to change the governor on the fly. To use it without the need to enter the root password, simply create following file:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>/var/lib/polkit-1/localauthority/50-local.d/org.gnome.cpufreqselector.pkla
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[org.gnome.cpufreqselector]
</span></span><span class=line><span class=cl>Identity=unix-user:user
</span></span><span class=line><span class=cl>Action=org.gnome.cpufreqselector
</span></span><span class=line><span class=cl>ResultAny=no
</span></span><span class=line><span class=cl>ResultInactive=no
</span></span><span class=line><span class=cl>ResultActive=yes
</span></span></code></pre></td></tr></table></div></div><p>Where the word user is replaced with the username of interest.</p><p>The
<a href=https://aur.archlinux.org/packages/desktop-privileges/ rel=noopener>desktop-privileges</a>AUR package in the
<a href=https://wiki.archlinux.org/index.php/AUR rel=noopener>AUR</a> contains a similar <code>.pkla</code> file for authorizing all users of the <code>power</code>
<a href=https://wiki.archlinux.org/index.php/User_group rel=noopener>user group</a> to change the governor.</p><h2 id=troubleshooting>Troubleshooting</h2><ul><li><p>Some applications, like
<a href=https://wiki.archlinux.org/index.php/Ntop rel=noopener>ntop</a>, do not respond well to automatic frequency scaling. In the case of ntop it can result in segmentation faults and lots of lost information as even the <code>on-demand</code> governor cannot change the frequency quickly enough when a lot of packets suddenly arrive at the monitored network interface that cannot be handled by the current processor speed.</p></li><li><p>Some CPU&rsquo;s may suffer from poor performance with the default settings of the <code>on-demand</code> governor (e.g. flash videos not playing smoothly or stuttering window animations). Instead of completely disabling frequency scaling to resolve these issues, the aggressiveness of frequency scaling can be increased by lowering the
<a href=https://wiki.archlinux.org/index.php/Sysctl rel=noopener>sysctl</a> variable for each CPU. See
<a href=https://wiki.archlinux.org/index.php/CPU_frequency_scaling rel=noopener>how to change the on-demand governor&rsquo;s threshold</a>.</p><p>up_threshold</p></li><li><p>Sometimes the on-demand governor may not throttle to the maximum frequency but one step below. This can be solved by setting max_freq value slightly higher than the real maximum. For example, if frequency range of the CPU is from 2.00 GHz to 3.00 GHz, setting max_freq to 3.01 GHz can be a good idea.</p></li><li><p>Some combinations of
<a href=https://wiki.archlinux.org/index.php/ALSA rel=noopener>ALSA</a> drivers and sound chips may cause audio skipping as the governor changes between frequencies, switching back to a non-changing governor seems to stop the audio skipping.</p></li></ul><p>Some CPU/BIOS configurations may have difficulties to scale to the maximum frequency or scale to higher frequencies at all. This is most likely caused by BIOS events telling the OS to limit the frequency resulting in <code>/sys/devices/system/cpu/cpu0/cpufreq/bios_limit</code> set to a lower value.</p><p>Either you just made a specific Setting in the BIOS Setup Utility, (Frequency, Thermal Management, etc.) you can blame a buggy/outdated BIOS or the BIOS might have a serious reason for throttling the CPU on it&rsquo;s own.</p><p>Reasons like that can be (assuming your machine&rsquo;s a notebook) that the battery is removed (or near death) so you&rsquo;re on AC-power only. In this case a weak AC-source might not supply enough electricity to fulfill extreme peak demands by the overall system and as there is no battery to assist this could lead to data loss, data corruption or in worst case even hardware damage!</p><p>Not all BIOS&rsquo;es limit the CPU-Frequency in this case, but for example most IBM/Lenovo Thinkpads do. Refer to thinkwiki for more
<a href=http://www.thinkwiki.org/wiki/Problem_with_CPU_frequency_scaling rel=noopener>thinkpad related info on this topic</a>.</p><p>If you checked there&rsquo;s not just an odd BIOS setting and you know what you&rsquo;re doing you can make the Kernel ignore these BIOS-limitations.</p><p><strong>Warning:</strong> Make sure you read and understood the section above. CPU frequency limitation is a safety feature of your BIOS and you should not need to work around it.</p><p>A special parameter has to be passed to the processor module.</p><p>For trying this temporarily change the value in <code>/sys/module/processor/parameters/ignore_ppc</code> from <code>0</code> to <code>1</code>.</p><p>For setting it permanently
<a href=https://wiki.archlinux.org/index.php/Kernel_modules rel=noopener>Kernel modules#Setting module options</a> describes alternatives. For example, you can add <code>processor.ignore_ppc=1</code> to your kernel boot line, or create</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>/etc/modprobe.d/ignore_ppc.conf
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># If the frequency of your machine gets wrongly limited by BIOS, this should help
</span></span><span class=line><span class=cl>options processor ignore_ppc=1
</span></span></code></pre></td></tr></table></div></div><h2 id=see-also>See also</h2></article><hr><div class=page-end><div class=backlinks-container><h3>Backlinks</h3><ul class=backlinks><li>No backlinks found</li></ul></div></div><div id=contact_buttons><footer><p>Made by Jacky Zhao using <a href=https://github.com/jackyzha0/quartz>Quartz</a>, Â© 2022</p><ul><li><a href=/>Home</a></li><li><a href=https://twitter.com/_jzhao>Twitter</a></li><li><a href=https://github.com/jackyzha0>Github</a></li></ul></footer></div><script src=https://lzyerste.github.io/quartz/js/popover.e57188d2e4c06b0654e020b3a734bb62.min.js></script>
<script>initPopover("https://lzyerste.github.io/quartz")</script></div></body></html>