<!doctype html><html lang=en><head><meta charset=utf-8><meta name=description content="How to find the driver (module) associated with a device on Linux? - Unix & Linux Stack Exchange  https://unix.stackexchange.com/questions/97676/how-to-find-the-driver-module-associated-with-a-device-on-linux"><title>How_to_find_the_driver__module__associated_with_a__e9b1dc5ab7cf4648ac6190c2e74c2958</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" type=image/png href=https://lzyerste.github.io/quartz//icon.png><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Source+Sans+Pro:wght@400;600;700&family=Fira+Code:wght@400;700&display=swap" rel=stylesheet><link href=https://lzyerste.github.io/quartz/styles.48db36360688fe00f0a39f3cf1417c4b.min.css rel=stylesheet><script src=https://lzyerste.github.io/quartz/js/darkmode.46b07878b7f5d9e26ad7a3c40f8a0605.min.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css integrity=sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js integrity=sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script>
<script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],throwOnError:!1})})</script><script>const BASE_URL="https://lzyerste.github.io/quartz/",fetchData=Promise.all([fetch("https://lzyerste.github.io/quartz/indices/linkIndex.1d754d57933a311cf3815175a0b0ad85.min.json").then(e=>e.json()).then(e=>({index:e.index,links:e.links})),fetch("https://lzyerste.github.io/quartz/indices/contentIndex.a420ce2210a8328ba962e4fa41ec3b7c.min.json").then(e=>e.json())]).then(([{index:e,links:t},n])=>({index:e,links:t,content:n}))</script></head><script async src="https://www.googletagmanager.com/gtag/js?id=G-XYFD95KB4J"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XYFD95KB4J",{anonymize_ip:!1})}</script><body><div id=search-container><div id=search-space><input autocomplete=off id=search-bar name=search type=text aria-label=Search placeholder="Search for something..."><div id=results-container></div></div></div><script src=https://cdn.jsdelivr.net/npm/flexsearch@0.7.21/dist/flexsearch.bundle.js integrity="sha256-i3A0NZGkhsKjVMzFxv3ksk0DZh3aXqu0l49Bbh0MdjE=" crossorigin=anonymous defer></script>
<script defer src=https://lzyerste.github.io/quartz/js/search.7861a82db330f0a40935b7458fee3a02.min.js></script><div class=singlePage><header><h1 id=page-title><a href=https://lzyerste.github.io/quartz/>ðŸª´ Quartz 3.2</a></h1><svg tabindex="0" id="search-icon" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search Icon</title><desc id="desc">Icon to open search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"/><circle cx="8" cy="8" r="7"/></g></svg><div class=spacer></div><div class=darkmode><input class=toggle id=darkmode-toggle type=checkbox tabindex=-1>
<label id=toggle-label-light for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="dayIcon" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35"><title>Light Mode</title><path d="M6 17.5C6 16.672 5.328 16 4.5 16h-3C.672 16 0 16.672.0 17.5S.672 19 1.5 19h3C5.328 19 6 18.328 6 17.5zM7.5 26c-.414.0-.789.168-1.061.439l-2 2C4.168 28.711 4 29.086 4 29.5 4 30.328 4.671 31 5.5 31c.414.0.789-.168 1.06-.44l2-2C8.832 28.289 9 27.914 9 27.5 9 26.672 8.329 26 7.5 26zm10-20C18.329 6 19 5.328 19 4.5v-3C19 .672 18.329.0 17.5.0S16 .672 16 1.5v3C16 5.328 16.671 6 17.5 6zm10 3c.414.0.789-.168 1.06-.439l2-2C30.832 6.289 31 5.914 31 5.5 31 4.672 30.329 4 29.5 4c-.414.0-.789.168-1.061.44l-2 2C26.168 6.711 26 7.086 26 7.5 26 8.328 26.671 9 27.5 9zM6.439 8.561C6.711 8.832 7.086 9 7.5 9 8.328 9 9 8.328 9 7.5c0-.414-.168-.789-.439-1.061l-2-2C6.289 4.168 5.914 4 5.5 4 4.672 4 4 4.672 4 5.5c0 .414.168.789.439 1.06l2 2.001zM33.5 16h-3c-.828.0-1.5.672-1.5 1.5s.672 1.5 1.5 1.5h3c.828.0 1.5-.672 1.5-1.5S34.328 16 33.5 16zM28.561 26.439C28.289 26.168 27.914 26 27.5 26c-.828.0-1.5.672-1.5 1.5.0.414.168.789.439 1.06l2 2C28.711 30.832 29.086 31 29.5 31c.828.0 1.5-.672 1.5-1.5.0-.414-.168-.789-.439-1.061l-2-2zM17.5 29c-.829.0-1.5.672-1.5 1.5v3c0 .828.671 1.5 1.5 1.5s1.5-.672 1.5-1.5v-3C19 29.672 18.329 29 17.5 29zm0-22C11.71 7 7 11.71 7 17.5S11.71 28 17.5 28 28 23.29 28 17.5 23.29 7 17.5 7zm0 18c-4.136.0-7.5-3.364-7.5-7.5s3.364-7.5 7.5-7.5 7.5 3.364 7.5 7.5S21.636 25 17.5 25z"/></svg></label><label id=toggle-label-dark for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="nightIcon" viewBox="0 0 100 100" style="enable-background='new 0 0 100 100'"><title>Dark Mode</title><path d="M96.76 66.458c-.853-.852-2.15-1.064-3.23-.534-6.063 2.991-12.858 4.571-19.655 4.571C62.022 70.495 50.88 65.88 42.5 57.5 29.043 44.043 25.658 23.536 34.076 6.47c.532-1.08.318-2.379-.534-3.23-.851-.852-2.15-1.064-3.23-.534-4.918 2.427-9.375 5.619-13.246 9.491-9.447 9.447-14.65 22.008-14.65 35.369.0 13.36 5.203 25.921 14.65 35.368s22.008 14.65 35.368 14.65c13.361.0 25.921-5.203 35.369-14.65 3.872-3.871 7.064-8.328 9.491-13.246C97.826 68.608 97.611 67.309 96.76 66.458z"/></svg></label></div></header><article><h1>How_to_find_the_driver__module__associated_with_a__e9b1dc5ab7cf4648ac6190c2e74c2958</h1><p class=meta>Last updated May 21, 2022</p><ul class=tags></ul><aside class=mainTOC><details><summary>Table of Contents</summary><nav id=TableOfContents><ol><li><ol><li><a href=#update>Update</a></li></ol></li></ol></nav></details></aside><h1 id=how-to-find-the-driver-module-associated-with-a-device-on-linux---unix--linux-stack-exchange>How to find the driver (module) associated with a device on Linux? - Unix & Linux Stack Exchange</h1><p><a href=https://unix.stackexchange.com/questions/97676/how-to-find-the-driver-module-associated-with-a-device-on-linux rel=noopener>https://unix.stackexchange.com/questions/97676/how-to-find-the-driver-module-associated-with-a-device-on-linux</a></p><p>To get this information from <code>sysfs</code> for a device file, first determine the major/minor number by looking at the output of <code>ls -l</code>, eg</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl> $ ls -l /dev/sda
</span></span><span class=line><span class=cl> brw-rw---- 1 root disk 8, 0 Apr 17 12:26 /dev/sda
</span></span></code></pre></td></tr></table></div></div><p>The <code>8, 0</code> tells us that major number is <code>8</code> and the minor is <code>0</code>. The <code>b</code> at the start of the listing also tells us that it is a block device. Other devices may have a <code>c</code> for character device at the start.</p><p>If you then look under <code>/sys/dev</code>, you will see there are two directories. One called <code>block</code> and one called <code>char</code>. The no-brainer here is that these are for block and character devices respectively. Each device is then accessible by its major/minor number is this directory. If there is a driver available for the device, it can be found by reading the target of the <code>driver</code> link in this or the <code>device</code> sub-directory. Eg, for my <code>/dev/sda</code> I can simply do:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ readlink /sys/dev/block/8\:0/device/driver
</span></span><span class=line><span class=cl>../../../../../../../bus/scsi/drivers/sd
</span></span></code></pre></td></tr></table></div></div><p>This shows that the <code>sd</code> driver is used for the device. If you are unsure if the device is a block or character device, in the shell you could simply replace this part with a <code>*</code>. This works just as well:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ readlink /sys/dev/*/8\:0/device/driver
</span></span><span class=line><span class=cl>../../../../../../../bus/scsi/drivers/sd
</span></span></code></pre></td></tr></table></div></div><p>Block devices can also be accessed directly through their name via either <code>/sys/block</code> or <code>/sys/class/block</code>. Eg:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ readlink /sys/block/sda/device/driver
</span></span><span class=line><span class=cl>../../../../../../../bus/scsi/drivers/sd
</span></span></code></pre></td></tr></table></div></div><p>Note that the existence of various directories in <code>/sys</code> may change depending on the kernel configuration. Also not all devices have a <code>device</code> subfolder. For example, this is the case for partition device files like <code>/dev/sda1</code>. Here you have to access the device for the whole disk (unfortunately there are no <code>sys</code> links for this).</p><p>A final thing which can be useful to do is to list the drivers for all devices for which they are available. For this you can use globs to select all the directories in which the driver links are present. Eg:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ ls -l /sys/dev/*/*/device/driver &amp;&amp; ls -l /sys/dev/*/*/driver 
</span></span><span class=line><span class=cl>lrwxrwxrwx 1 root root 0 Apr 17 12:27 /sys/dev/block/11:0/device/driver -&gt; ../../../../../../../bus/scsi/drivers/sr
</span></span><span class=line><span class=cl>lrwxrwxrwx 1 root root 0 Apr 17 12:26 /sys/dev/block/8:0/device/driver -&gt; ../../../../../../../bus/scsi/drivers/sd
</span></span><span class=line><span class=cl>lrwxrwxrwx 1 root root 0 Apr 17 12:26 /sys/dev/block/8:16/device/driver -&gt; ../../../../../../../bus/scsi/drivers/sd
</span></span><span class=line><span class=cl>lrwxrwxrwx 1 root root 0 Apr 17 12:26 /sys/dev/block/8:32/device/driver -&gt; ../../../../../../../../../bus/scsi/drivers/sd
</span></span><span class=line><span class=cl>lrwxrwxrwx 1 root root 0 Apr 17 20:38 /sys/dev/char/189:0/driver -&gt; ../../../../bus/usb/drivers/usb
</span></span><span class=line><span class=cl>lrwxrwxrwx 1 root root 0 Apr 17 20:38 /sys/dev/char/189:1024/driver -&gt; ../../../../bus/usb/drivers/usb
</span></span><span class=line><span class=cl>lrwxrwxrwx 1 root root 0 Apr 17 20:38 /sys/dev/char/189:128/driver -&gt; ../../../../bus/usb/drivers/usb
</span></span><span class=line><span class=cl>lrwxrwxrwx 1 root root 0 Apr 17 20:38 /sys/dev/char/189:256/driver -&gt; ../../../../bus/usb/drivers/usb
</span></span><span class=line><span class=cl>lrwxrwxrwx 1 root root 0 Apr 17 20:38 /sys/dev/char/189:384/driver -&gt; ../../../../bus/usb/drivers/usb
</span></span><span class=line><span class=cl>lrwxrwxrwx 1 root root 0 Apr 17 12:26 /sys/dev/char/189:512/driver -&gt; ../../../../bus/usb/drivers/usb
</span></span><span class=line><span class=cl>lrwxrwxrwx 1 root root 0 Apr 17 12:26 /sys/dev/char/189:513/driver -&gt; ../../../../../bus/usb/drivers/usb
</span></span><span class=line><span class=cl>lrwxrwxrwx 1 root root 0 Apr 17 12:26 /sys/dev/char/189:514/driver -&gt; ../../../../../bus/usb/drivers/usb
</span></span><span class=line><span class=cl>lrwxrwxrwx 1 root root 0 Apr 17 12:26 /sys/dev/char/189:640/driver -&gt; ../../../../bus/usb/drivers/usb
</span></span><span class=line><span class=cl>lrwxrwxrwx 1 root root 0 Apr 17 12:26 /sys/dev/char/189:643/driver -&gt; ../../../../../bus/usb/drivers/usb
</span></span><span class=line><span class=cl>lrwxrwxrwx 1 root root 0 Apr 17 20:38 /sys/dev/char/189:768/driver -&gt; ../../../../bus/usb/drivers/usb
</span></span><span class=line><span class=cl>lrwxrwxrwx 1 root root 0 Apr 17 20:38 /sys/dev/char/189:896/driver -&gt; ../../../../bus/usb/drivers/usb
</span></span><span class=line><span class=cl>lrwxrwxrwx 1 root root 0 Apr 17 12:26 /sys/dev/char/21:0/device/driver -&gt; ../../../../../../../bus/scsi/drivers/sd
</span></span><span class=line><span class=cl>lrwxrwxrwx 1 root root 0 Apr 17 12:26 /sys/dev/char/21:1/device/driver -&gt; ../../../../../../../bus/scsi/drivers/sd
</span></span><span class=line><span class=cl>lrwxrwxrwx 1 root root 0 Apr 17 12:27 /sys/dev/char/21:2/device/driver -&gt; ../../../../../../../bus/scsi/drivers/sr
</span></span><span class=line><span class=cl>lrwxrwxrwx 1 root root 0 Apr 17 12:26 /sys/dev/char/21:3/device/driver -&gt; ../../../../../../../../../bus/scsi/drivers/sd
</span></span><span class=line><span class=cl>lrwxrwxrwx 1 root root 0 Apr 17 12:26 /sys/dev/char/250:0/device/driver -&gt; ../../../../../../../bus/hid/drivers/hid-generic
</span></span><span class=line><span class=cl>lrwxrwxrwx 1 root root 0 Apr 17 12:26 /sys/dev/char/250:1/device/driver -&gt; ../../../../../../../bus/hid/drivers/hid-generic
</span></span><span class=line><span class=cl>lrwxrwxrwx 1 root root 0 Apr 17 12:26 /sys/dev/char/250:2/device/driver -&gt; ../../../../../../../bus/hid/drivers/hid-generic
</span></span><span class=line><span class=cl>lrwxrwxrwx 1 root root 0 Apr 17 12:26 /sys/dev/char/252:0/device/driver -&gt; ../../../../../../../bus/scsi/drivers/sd
</span></span><span class=line><span class=cl>lrwxrwxrwx 1 root root 0 Apr 17 12:26 /sys/dev/char/252:1/device/driver -&gt; ../../../../../../../bus/scsi/drivers/sd
</span></span><span class=line><span class=cl>lrwxrwxrwx 1 root root 0 Apr 17 12:27 /sys/dev/char/252:2/device/driver -&gt; ../../../../../../../bus/scsi/drivers/sr
</span></span><span class=line><span class=cl>lrwxrwxrwx 1 root root 0 Apr 17 12:26 /sys/dev/char/252:3/device/driver -&gt; ../../../../../../../../../bus/scsi/drivers/sd
</span></span><span class=line><span class=cl>lrwxrwxrwx 1 root root 0 Apr 17 19:53 /sys/dev/char/254:0/device/driver -&gt; ../../../bus/pnp/drivers/rtc_cmos
</span></span><span class=line><span class=cl>lrwxrwxrwx 1 root root 0 Apr 17 19:53 /sys/dev/char/29:0/device/driver -&gt; ../../../bus/platform/drivers/simple-framebuffer
</span></span><span class=line><span class=cl>lrwxrwxrwx 1 root root 0 Apr 17 19:53 /sys/dev/char/4:64/device/driver -&gt; ../../../bus/pnp/drivers/serial
</span></span><span class=line><span class=cl>lrwxrwxrwx 1 root root 0 Apr 17 19:53 /sys/dev/char/4:65/device/driver -&gt; ../../../bus/platform/drivers/serial8250
</span></span><span class=line><span class=cl>lrwxrwxrwx 1 root root 0 Apr 17 19:53 /sys/dev/char/4:66/device/driver -&gt; ../../../bus/platform/drivers/serial8250
</span></span><span class=line><span class=cl>lrwxrwxrwx 1 root root 0 Apr 17 19:53 /sys/dev/char/4:67/device/driver -&gt; ../../../bus/platform/drivers/serial8250
</span></span><span class=line><span class=cl>lrwxrwxrwx 1 root root 0 Apr 17 12:26 /sys/dev/char/6:0/device/driver -&gt; ../../../bus/pnp/drivers/parport_pc
</span></span><span class=line><span class=cl>lrwxrwxrwx 1 root root 0 Apr 17 12:26 /sys/dev/char/99:0/device/driver -&gt; ../../../bus/pnp/drivers/parport_pc
</span></span></code></pre></td></tr></table></div></div><p>Finally, to diverge from the question a bit, I will add another <code>/sys</code> glob trick to get a much broader perspective on which drivers are being used by which devices (though not necessarily those with a device file):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>find /sys/bus/*/drivers/* -maxdepth 1 -lname &#39;*devices*&#39; -ls
</span></span></code></pre></td></tr></table></div></div><h3 id=update>Update</h3><p>Looking more closely at the output of <code>udevadm</code>, it appears to work by finding the canonical <code>/sys</code> directory (as you would get if you dereferenced the major/minor directories above), then working its way up the directory tree, printing out any information that it finds. This way you get information about parent devices and any drivers they use as well.</p><p>To experiment with this I wrote the script below to walk up the directory tree and display information at each relevant level. <code>udev</code> seems to look for readable files at each level, with their names and contents being incorporated in <code>ATTRS</code>. Instead of doing this I display the contents of the <code>uevent</code> files at each level (seemingly the presence of this defines a distinct level rather than just a subdirectory). I also show the basename of any subsystem links I find and this showing how the device fits in this hierarchy. <code>udevadm</code> does not display the same information, so this is a nice complementary tool. The parent device information (eg <code>PCI</code> information) is also useful if you want to match the output of other tools like <code>lshw</code> to higher level devices.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=nv>dev</span><span class=o>=</span><span class=k>$(</span>readlink -m <span class=nv>$1</span><span class=k>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># test for block/character device</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[</span> -b <span class=s2>&#34;</span><span class=nv>$dev</span><span class=s2>&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>  <span class=nv>mode</span><span class=o>=</span>block
</span></span><span class=line><span class=cl><span class=k>elif</span> <span class=o>[</span> -c <span class=s2>&#34;</span><span class=nv>$dev</span><span class=s2>&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>  <span class=nv>mode</span><span class=o>=</span>char
</span></span><span class=line><span class=cl><span class=k>else</span>
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$dev</span><span class=s2> is not a device file&#34;</span> &gt;<span class=p>&amp;</span><span class=m>2</span>
</span></span><span class=line><span class=cl>  <span class=nb>exit</span> <span class=m>1</span>
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># stat outputs major/minor in hex, convert to decimal</span>
</span></span><span class=line><span class=cl><span class=nv>data</span><span class=o>=(</span> <span class=k>$(</span>stat -c <span class=s1>&#39;%t %T&#39;</span> <span class=nv>$dev</span><span class=k>)</span> <span class=o>)</span> <span class=o>||</span> <span class=nb>exit</span> <span class=m>2</span>
</span></span><span class=line><span class=cl><span class=nv>major</span><span class=o>=</span><span class=k>$((</span> <span class=m>0</span>x<span class=si>${</span><span class=nv>data</span><span class=p>[0]</span><span class=si>}</span> <span class=k>))</span>
</span></span><span class=line><span class=cl><span class=nv>minor</span><span class=o>=</span><span class=k>$((</span> <span class=m>0</span>x<span class=si>${</span><span class=nv>data</span><span class=p>[1]</span><span class=si>}</span> <span class=k>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> -e <span class=s2>&#34;Given device:     </span><span class=nv>$1</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> -e <span class=s2>&#34;Canonical device: </span><span class=nv>$dev</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> -e <span class=s2>&#34;Major: </span><span class=nv>$major</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> -e <span class=s2>&#34;Minor: </span><span class=nv>$minor</span><span class=s2>\n&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># sometimes nodes have been created for devices that are not present</span>
</span></span><span class=line><span class=cl><span class=nv>dir</span><span class=o>=</span><span class=k>$(</span>readlink -f /sys/dev/<span class=nv>$mode</span>/<span class=nv>$major</span><span class=se>\:</span><span class=nv>$minor</span><span class=k>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> ! <span class=o>[</span> -e <span class=s2>&#34;</span><span class=nv>$dir</span><span class=s2>&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> <span class=s2>&#34;No /sys entry for </span><span class=nv>$dev</span><span class=s2>&#34;</span> &gt;<span class=p>&amp;</span><span class=m>2</span>
</span></span><span class=line><span class=cl>  <span class=nb>exit</span> <span class=m>3</span>
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># walk up the /sys hierarchy one directory at a time</span>
</span></span><span class=line><span class=cl><span class=c1># stop when there are three levels left </span>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=o>[</span> <span class=nv>$dir</span> <span class=o>==</span> /*/*/* <span class=o>](</span> <span class=nv>$dir</span> <span class=o>==</span> /*/*/* <span class=o>)</span><span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1># it seems the directory is only of interest if there is a &#39;uevent&#39; file</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=o>[</span> -e <span class=s2>&#34;</span><span class=nv>$dir</span><span class=s2>/uevent&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$dir</span><span class=s2>:&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;  Uevent:&#34;</span>
</span></span><span class=line><span class=cl>    sed <span class=s1>&#39;s/^/    /&#39;</span> <span class=s2>&#34;</span><span class=nv>$dir</span><span class=s2>/uevent&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># check for subsystem link</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>[</span> -d <span class=s2>&#34;</span><span class=nv>$dir</span><span class=s2>/subsystem&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>        <span class=nv>subsystem</span><span class=o>=</span><span class=k>$(</span>readlink -f <span class=s2>&#34;</span><span class=nv>$dir</span><span class=s2>/subsystem&#34;</span><span class=k>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>echo</span> -e <span class=s2>&#34;\n  Subsystem:\n    </span><span class=si>${</span><span class=nv>subsystem</span><span class=p>##*/</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>fi</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span>
</span></span><span class=line><span class=cl>  <span class=k>fi</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1># strip a subdirectory</span>
</span></span><span class=line><span class=cl>  <span class=nv>dir</span><span class=o>=</span><span class=si>${</span><span class=nv>dir</span><span class=p>%/*</span><span class=si>}</span>
</span></span><span class=line><span class=cl><span class=k>done</span>
</span></span></code></pre></td></tr></table></div></div></article><hr><div class=page-end><div class=backlinks-container><h3>Backlinks</h3><ul class=backlinks><li>No backlinks found</li></ul></div></div><div id=contact_buttons><footer><p>Made by Jacky Zhao using <a href=https://github.com/jackyzha0/quartz>Quartz</a>, Â© 2022</p><ul><li><a href=/>Home</a></li><li><a href=https://twitter.com/_jzhao>Twitter</a></li><li><a href=https://github.com/jackyzha0>Github</a></li></ul></footer></div><script src=https://lzyerste.github.io/quartz/js/popover.e57188d2e4c06b0654e020b3a734bb62.min.js></script>
<script>initPopover("https://lzyerste.github.io/quartz")</script></div></body></html>