<!doctype html><html lang=en><head><meta charset=utf-8><meta name=description content="3. Transport Layer 3.1 Introduction and Transport-Layer Services  TCP  reliable data transfer congestion control    3.2 Multiplexing and Demultiplexing  传输层收到的包向上提供给哪个应用（socket）？使用端口号  (1) that sockets have unique identifiers (2) that each segment have special fields that indicate the socket to which the segment is to be delivered Each port number is a 16-bit number, ranging from 0 to 65535."><title>3_Transport_Layer_a65f6687a0434b84bd9f8153cc11d546</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" type=image/png href=https://lzyerste.github.io/quartz//icon.png><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Source+Sans+Pro:wght@400;600;700&family=Fira+Code:wght@400;700&display=swap" rel=stylesheet><link href=https://lzyerste.github.io/quartz/styles.48db36360688fe00f0a39f3cf1417c4b.min.css rel=stylesheet><script src=https://lzyerste.github.io/quartz/js/darkmode.46b07878b7f5d9e26ad7a3c40f8a0605.min.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css integrity=sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js integrity=sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script>
<script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],throwOnError:!1})})</script><script>const BASE_URL="https://lzyerste.github.io/quartz/",fetchData=Promise.all([fetch("https://lzyerste.github.io/quartz/indices/linkIndex.d9d5859c0e0b3db667123f4df2b3a95c.min.json").then(e=>e.json()).then(e=>({index:e.index,links:e.links})),fetch("https://lzyerste.github.io/quartz/indices/contentIndex.8142ea9941fd6973dd3e16e4214a0035.min.json").then(e=>e.json())]).then(([{index:e,links:t},n])=>({index:e,links:t,content:n}))</script></head><script async src="https://www.googletagmanager.com/gtag/js?id=G-XYFD95KB4J"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XYFD95KB4J",{anonymize_ip:!1})}</script><body><div id=search-container><div id=search-space><input autocomplete=off id=search-bar name=search type=text aria-label=Search placeholder="Search for something..."><div id=results-container></div></div></div><script src=https://cdn.jsdelivr.net/npm/flexsearch@0.7.21/dist/flexsearch.bundle.js integrity="sha256-i3A0NZGkhsKjVMzFxv3ksk0DZh3aXqu0l49Bbh0MdjE=" crossorigin=anonymous defer></script>
<script defer src=https://lzyerste.github.io/quartz/js/search.7861a82db330f0a40935b7458fee3a02.min.js></script><div class=singlePage><header><h1 id=page-title><a href=https://lzyerste.github.io/quartz/>🪴 Quartz 3.2</a></h1><svg tabindex="0" id="search-icon" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search Icon</title><desc id="desc">Icon to open search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"/><circle cx="8" cy="8" r="7"/></g></svg><div class=spacer></div><div class=darkmode><input class=toggle id=darkmode-toggle type=checkbox tabindex=-1>
<label id=toggle-label-light for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="dayIcon" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35"><title>Light Mode</title><path d="M6 17.5C6 16.672 5.328 16 4.5 16h-3C.672 16 0 16.672.0 17.5S.672 19 1.5 19h3C5.328 19 6 18.328 6 17.5zM7.5 26c-.414.0-.789.168-1.061.439l-2 2C4.168 28.711 4 29.086 4 29.5 4 30.328 4.671 31 5.5 31c.414.0.789-.168 1.06-.44l2-2C8.832 28.289 9 27.914 9 27.5 9 26.672 8.329 26 7.5 26zm10-20C18.329 6 19 5.328 19 4.5v-3C19 .672 18.329.0 17.5.0S16 .672 16 1.5v3C16 5.328 16.671 6 17.5 6zm10 3c.414.0.789-.168 1.06-.439l2-2C30.832 6.289 31 5.914 31 5.5 31 4.672 30.329 4 29.5 4c-.414.0-.789.168-1.061.44l-2 2C26.168 6.711 26 7.086 26 7.5 26 8.328 26.671 9 27.5 9zM6.439 8.561C6.711 8.832 7.086 9 7.5 9 8.328 9 9 8.328 9 7.5c0-.414-.168-.789-.439-1.061l-2-2C6.289 4.168 5.914 4 5.5 4 4.672 4 4 4.672 4 5.5c0 .414.168.789.439 1.06l2 2.001zM33.5 16h-3c-.828.0-1.5.672-1.5 1.5s.672 1.5 1.5 1.5h3c.828.0 1.5-.672 1.5-1.5S34.328 16 33.5 16zM28.561 26.439C28.289 26.168 27.914 26 27.5 26c-.828.0-1.5.672-1.5 1.5.0.414.168.789.439 1.06l2 2C28.711 30.832 29.086 31 29.5 31c.828.0 1.5-.672 1.5-1.5.0-.414-.168-.789-.439-1.061l-2-2zM17.5 29c-.829.0-1.5.672-1.5 1.5v3c0 .828.671 1.5 1.5 1.5s1.5-.672 1.5-1.5v-3C19 29.672 18.329 29 17.5 29zm0-22C11.71 7 7 11.71 7 17.5S11.71 28 17.5 28 28 23.29 28 17.5 23.29 7 17.5 7zm0 18c-4.136.0-7.5-3.364-7.5-7.5s3.364-7.5 7.5-7.5 7.5 3.364 7.5 7.5S21.636 25 17.5 25z"/></svg></label><label id=toggle-label-dark for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="nightIcon" viewBox="0 0 100 100" style="enable-background='new 0 0 100 100'"><title>Dark Mode</title><path d="M96.76 66.458c-.853-.852-2.15-1.064-3.23-.534-6.063 2.991-12.858 4.571-19.655 4.571C62.022 70.495 50.88 65.88 42.5 57.5 29.043 44.043 25.658 23.536 34.076 6.47c.532-1.08.318-2.379-.534-3.23-.851-.852-2.15-1.064-3.23-.534-4.918 2.427-9.375 5.619-13.246 9.491-9.447 9.447-14.65 22.008-14.65 35.369.0 13.36 5.203 25.921 14.65 35.368s22.008 14.65 35.368 14.65c13.361.0 25.921-5.203 35.369-14.65 3.872-3.871 7.064-8.328 9.491-13.246C97.826 68.608 97.611 67.309 96.76 66.458z"/></svg></label></div></header><article><h1>3_Transport_Layer_a65f6687a0434b84bd9f8153cc11d546</h1><p class=meta>Last updated Unknown</p><ul class=tags></ul><h1 id=3-transport-layer>3. Transport Layer</h1><h2 id=31-introduction-and-transport-layer-services>3.1 Introduction and Transport-Layer Services</h2><ul><li>TCP<ul><li>reliable data transfer</li><li>congestion control</li></ul></li></ul><h2 id=32-multiplexing-and-demultiplexing>3.2 Multiplexing and Demultiplexing</h2><ul><li>传输层收到的包向上提供给哪个应用（socket）？使用端口号<ul><li>(1) that sockets have unique identifiers</li><li>(2) that each segment have special fields that indicate the socket to which the segment is to be delivered</li><li>Each port number is a 16-bit number, ranging from 0 to 65535.</li></ul></li><li><code>TCP socket</code> is identified by a four-tuple: (source IP address, source port number, destination IP address, destination port number)</li></ul><h2 id=33-connectionless-transport-udp>3.3 Connectionless Transport: UDP</h2><ul><li>无握手，无连接，无状态。端口+简单的错误检查。RFC 768</li><li>DNS</li><li>SNMP</li><li>可靠性可以在应用层实现。</li></ul><p><img src=/3%20Transport%20Layer%20a65f6687a0434b84bd9f8153cc11d546/Untitled.png alt=3%20Transport%20Layer%20a65f6687a0434b84bd9f8153cc11d546/Untitled.png></p><ul><li>UDP的checksum计算方式：以16位为单位，累加起来，高位溢出的进位放到低位继续加。最后使用1的补码，也就是0变1，1变0，作为checksum。那么，接收方收到后，全加起来应该是全1。</li><li>传输层不能够依赖底层的错误检测，而应该使用end-end principle，在自己这一层解决。</li><li>UDP提供错误检测，但没有纠错能力。</li></ul><h2 id=34-principles-of-reliable-data-transfer>3.4 Principles of Reliable Data Transfer</h2><ul><li><p>With a reliable channel, no transferred data bits are corrupted (flipped from 0 to 1, or vice versa) or lost, and all are delivered in the order in which they were sent.</p><ul><li>底层是不可靠的，可能会丢包、包损坏、到达顺序与发送顺序不一样。但假设底层是按照收包顺序转发包的，没有重新排序。</li></ul></li><li><p>rdt1.0，假设底层是完全可靠的</p><p>状态机：</p><p><img src=/3%20Transport%20Layer%20a65f6687a0434b84bd9f8153cc11d546/Untitled%201.png alt=3%20Transport%20Layer%20a65f6687a0434b84bd9f8153cc11d546/Untitled%201.png></p></li><li><p>rdt2.0，数据可能会被破坏</p><ul><li>ARQ (Automatic Repeat reQuest) protocols</li><li>Error detection. 比如checksum，接收者检测。</li><li>Receiver feedback. 比如ACK与NAK，接收者回复。</li><li>Retransmission. 发送者重发。</li></ul><p>状态机：</p><p><img src=/3%20Transport%20Layer%20a65f6687a0434b84bd9f8153cc11d546/Untitled%202.png alt=3%20Transport%20Layer%20a65f6687a0434b84bd9f8153cc11d546/Untitled%202.png></p><p><img src=/3%20Transport%20Layer%20a65f6687a0434b84bd9f8153cc11d546/Untitled%203.png alt=3%20Transport%20Layer%20a65f6687a0434b84bd9f8153cc11d546/Untitled%203.png></p><ul><li>rdt2.0也称为stop-and-wait protocols，因为发送一个包，ACK后，再发送下一个包。</li><li>有个致命缺陷：接收者发送的ACK或NAK也有可能损坏。ACK包也要加上checksum，但是发送者只是收到一个损坏的包，并不知道它是不是ACK，所以并不会出发重发。<ul><li>解决办法：添加一个字段，sequence number</li></ul></li></ul></li><li><p>rdt3.0</p><ul><li>现在底层会丢包</li><li>how to detect packet loss and what to do when packet loss occurs</li><li>使用timeout</li></ul></li></ul><hr><p>性能问题：stop-and-wait，使用pipeline，同时发送多个包</p><p>重发机制：Go-Back-N and selective repeat</p><h2 id=35-connection-oriented-transport-tcp>3.5 Connection-Oriented Transport: TCP</h2><ul><li>connection-oriented, reliable</li><li>TCP运行在两个终端（end system），中间网络不关心TCP的状态。</li><li>全双工，点对点</li><li>三次握手，three-way handshake</li></ul><p><img src=/3%20Transport%20Layer%20a65f6687a0434b84bd9f8153cc11d546/Untitled%204.png alt=3%20Transport%20Layer%20a65f6687a0434b84bd9f8153cc11d546/Untitled%204.png></p><ul><li>sequence number & acknowledgement number: 用来实现可靠机制<ul><li>sequence number：字节流的偏移地址</li><li>acknowledgement number：接收端通知发送端下次发送的起始地址，也就是说，它之前的数据都以完整收到。</li><li>起始号其实是建立连接时随机选的，从0开始只是逻辑上对待。</li></ul></li><li>Telnet</li><li>Go-Back-N or Selective Repeat?</li></ul><h2 id=36-principles-of-congestion-control>3.6 Principles of Congestion Control</h2></article><hr><div class=page-end><div class=backlinks-container><h3>Backlinks</h3><ul class=backlinks><li>No backlinks found</li></ul></div></div><div id=contact_buttons><footer><p>Made by Jacky Zhao using <a href=https://github.com/jackyzha0/quartz>Quartz</a>, © 2022</p><ul><li><a href=/>Home</a></li><li><a href=https://twitter.com/_jzhao>Twitter</a></li><li><a href=https://github.com/jackyzha0>Github</a></li></ul></footer></div><script src=https://lzyerste.github.io/quartz/js/popover.e57188d2e4c06b0654e020b3a734bb62.min.js></script>
<script>initPopover("https://lzyerste.github.io/quartz")</script></div></body></html>