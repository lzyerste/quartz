<!doctype html><html lang=en><head><meta charset=utf-8><meta name=description content="#gdb
 gdb.pdf
GDB  https://sourceware.org/gdb/onlinedocs/gdb/index.html
 https://www.cs.umd.edu/~srhuang/teaching/cmsc212/gdb-tutorial-handout.pdf
gdb里回车键默认会执行上一次的命令。
启动 方式一：直接启动。
例子（带参数）：
1  sudo gdb --args ./build/zns/zns_cli write --zone-id=5 --bs=16k --size=16k --verbose   如果不带参数，直接gdb <prog>即可。"><title>gdb</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" type=image/png href=https://lzyerste.github.io/quartz//icon.png><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Source+Sans+Pro:wght@400;600;700&family=Fira+Code:wght@400;700&display=swap" rel=stylesheet><link href=https://lzyerste.github.io/quartz/styles.48db36360688fe00f0a39f3cf1417c4b.min.css rel=stylesheet><script src=https://lzyerste.github.io/quartz/js/darkmode.46b07878b7f5d9e26ad7a3c40f8a0605.min.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css integrity=sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js integrity=sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script>
<script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],throwOnError:!1})})</script><script>const BASE_URL="https://lzyerste.github.io/quartz/",fetchData=Promise.all([fetch("https://lzyerste.github.io/quartz/indices/linkIndex.2e6129a8792c8eebefa64fbcd3ffe852.min.json").then(e=>e.json()).then(e=>({index:e.index,links:e.links})),fetch("https://lzyerste.github.io/quartz/indices/contentIndex.b61d318cd78ade9c89f9431c1e8e7e2c.min.json").then(e=>e.json())]).then(([{index:e,links:t},n])=>({index:e,links:t,content:n}))</script></head><script async src="https://www.googletagmanager.com/gtag/js?id=G-XYFD95KB4J"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XYFD95KB4J",{anonymize_ip:!1})}</script><body><div id=search-container><div id=search-space><input autocomplete=off id=search-bar name=search type=text aria-label=Search placeholder="Search for something..."><div id=results-container></div></div></div><script src=https://cdn.jsdelivr.net/npm/flexsearch@0.7.21/dist/flexsearch.bundle.js integrity="sha256-i3A0NZGkhsKjVMzFxv3ksk0DZh3aXqu0l49Bbh0MdjE=" crossorigin=anonymous defer></script>
<script defer src=https://lzyerste.github.io/quartz/js/search.7861a82db330f0a40935b7458fee3a02.min.js></script><div class=singlePage><header><h1 id=page-title><a href=https://lzyerste.github.io/quartz/>🪴 Quartz 3.2</a></h1><svg tabindex="0" id="search-icon" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search Icon</title><desc id="desc">Icon to open search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"/><circle cx="8" cy="8" r="7"/></g></svg><div class=spacer></div><div class=darkmode><input class=toggle id=darkmode-toggle type=checkbox tabindex=-1>
<label id=toggle-label-light for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="dayIcon" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35"><title>Light Mode</title><path d="M6 17.5C6 16.672 5.328 16 4.5 16h-3C.672 16 0 16.672.0 17.5S.672 19 1.5 19h3C5.328 19 6 18.328 6 17.5zM7.5 26c-.414.0-.789.168-1.061.439l-2 2C4.168 28.711 4 29.086 4 29.5 4 30.328 4.671 31 5.5 31c.414.0.789-.168 1.06-.44l2-2C8.832 28.289 9 27.914 9 27.5 9 26.672 8.329 26 7.5 26zm10-20C18.329 6 19 5.328 19 4.5v-3C19 .672 18.329.0 17.5.0S16 .672 16 1.5v3C16 5.328 16.671 6 17.5 6zm10 3c.414.0.789-.168 1.06-.439l2-2C30.832 6.289 31 5.914 31 5.5 31 4.672 30.329 4 29.5 4c-.414.0-.789.168-1.061.44l-2 2C26.168 6.711 26 7.086 26 7.5 26 8.328 26.671 9 27.5 9zM6.439 8.561C6.711 8.832 7.086 9 7.5 9 8.328 9 9 8.328 9 7.5c0-.414-.168-.789-.439-1.061l-2-2C6.289 4.168 5.914 4 5.5 4 4.672 4 4 4.672 4 5.5c0 .414.168.789.439 1.06l2 2.001zM33.5 16h-3c-.828.0-1.5.672-1.5 1.5s.672 1.5 1.5 1.5h3c.828.0 1.5-.672 1.5-1.5S34.328 16 33.5 16zM28.561 26.439C28.289 26.168 27.914 26 27.5 26c-.828.0-1.5.672-1.5 1.5.0.414.168.789.439 1.06l2 2C28.711 30.832 29.086 31 29.5 31c.828.0 1.5-.672 1.5-1.5.0-.414-.168-.789-.439-1.061l-2-2zM17.5 29c-.829.0-1.5.672-1.5 1.5v3c0 .828.671 1.5 1.5 1.5s1.5-.672 1.5-1.5v-3C19 29.672 18.329 29 17.5 29zm0-22C11.71 7 7 11.71 7 17.5S11.71 28 17.5 28 28 23.29 28 17.5 23.29 7 17.5 7zm0 18c-4.136.0-7.5-3.364-7.5-7.5s3.364-7.5 7.5-7.5 7.5 3.364 7.5 7.5S21.636 25 17.5 25z"/></svg></label><label id=toggle-label-dark for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="nightIcon" viewBox="0 0 100 100" style="enable-background='new 0 0 100 100'"><title>Dark Mode</title><path d="M96.76 66.458c-.853-.852-2.15-1.064-3.23-.534-6.063 2.991-12.858 4.571-19.655 4.571C62.022 70.495 50.88 65.88 42.5 57.5 29.043 44.043 25.658 23.536 34.076 6.47c.532-1.08.318-2.379-.534-3.23-.851-.852-2.15-1.064-3.23-.534-4.918 2.427-9.375 5.619-13.246 9.491-9.447 9.447-14.65 22.008-14.65 35.369.0 13.36 5.203 25.921 14.65 35.368s22.008 14.65 35.368 14.65c13.361.0 25.921-5.203 35.369-14.65 3.872-3.871 7.064-8.328 9.491-13.246C97.826 68.608 97.611 67.309 96.76 66.458z"/></svg></label></div></header><article><h1>gdb</h1><p class=meta>Last updated June 7, 2022</p><ul class=tags></ul><aside class=mainTOC><details><summary>Table of Contents</summary><nav id=TableOfContents><ol><li><a href=#启动>启动</a></li><li><a href=#run>run</a></li><li><a href=#breakpoints>breakpoints</a></li><li><a href=#continue>continue</a></li><li><a href=#next>next</a></li><li><a href=#step>step</a></li><li><a href=#print>print</a></li><li><a href=#watch>watch</a></li><li><a href=#backtrace>backtrace</a></li><li><a href=#stack-frame>stack frame</a></li><li><a href=#反汇编>反汇编</a></li><li><a href=#修改内存打印内存>修改内存/打印内存</a></li><li><a href=#dump内存到文件>dump内存到文件</a></li><li><a href=#更改寄存器内容>更改寄存器内容？</a></li><li><a href=#直接执行函数>直接执行函数</a></li><li><a href=#tips>TIPS</a><ol><li><a href=#脚本自动执行>脚本自动执行</a></li></ol></li><li><a href=#退出不要确认>退出不要确认</a></li><li><a href=#案例>案例</a><ol><li><a href=#sdpk程序单步执行>sdpk程序单步执行</a></li><li><a href=#spdk-crash-core分析>spdk crash core分析</a></li><li><a href=#固件现场恢复>固件现场恢复</a></li></ol></li><li><a href=#资源>资源</a></li></ol></nav></details></aside><p>#gdb</p><p><a rel=noopener class="internal-link broken" data-src=assets/gdb.pdf>gdb.pdf</a></p><h1 id=gdb>GDB</h1><p><a href=https://sourceware.org/gdb/onlinedocs/gdb/index.html rel=noopener>https://sourceware.org/gdb/onlinedocs/gdb/index.html</a></p><p><a href=https://www.cs.umd.edu/~srhuang/teaching/cmsc212/gdb-tutorial-handout.pdf rel=noopener>https://www.cs.umd.edu/~srhuang/teaching/cmsc212/gdb-tutorial-handout.pdf</a></p><p>gdb里回车键默认会执行上一次的命令。</p><h2 id=启动>启动</h2><p>方式一：直接启动。</p><p>例子（带参数）：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>sudo gdb --args ./build/zns/zns_cli write --zone-id<span class=o>=</span><span class=m>5</span> --bs<span class=o>=</span>16k --size<span class=o>=</span>16k --verbose
</span></span></code></pre></td></tr></table></div></div><p>如果不带参数，直接<code>gdb &lt;prog></code>即可。</p><hr><p>方式二：先启动gdb，再加载程序。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=o>(</span>gdb<span class=o>)</span> file prog1.x
</span></span></code></pre></td></tr></table></div></div><h2 id=run>run</h2><p>通过命令<code>run</code>开始执行程序。可以简写为<code>r</code>。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=o>(</span>gdb<span class=o>)</span> run
</span></span></code></pre></td></tr></table></div></div><p>如果程序没有错误，那么一直执行完毕。如果程序有bug，那么出错时会打印些信息。比如：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>Program received signal SIGSEGV, Segmentation fault.
</span></span><span class=line><span class=cl>0x0000000000400524 in sum array region <span class=o>(</span><span class=nv>arr</span><span class=o>=</span>0x7fffc902a270, <span class=nv>r1</span><span class=o>=</span>2, <span class=nv>c1</span><span class=o>=</span>5, <span class=nv>r2</span><span class=o>=</span>4, <span class=nv>c2</span><span class=o>=</span>6<span class=o>)</span> at sum-array-region2.c:12
</span></span></code></pre></td></tr></table></div></div><h2 id=breakpoints>breakpoints</h2><p>通过命令<code>break</code>设置断点。可以简写为<code>b</code>。</p><p>方式一：文件名+行号。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=o>(</span>gdb<span class=o>)</span> <span class=nb>break</span> file1.c:6
</span></span></code></pre></td></tr></table></div></div><p>方式二：函数名。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=o>(</span>gdb<span class=o>)</span> <span class=nb>break</span> my_func
</span></span></code></pre></td></tr></table></div></div><p>查看所有断点设置信息：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=o>(</span>gdb<span class=o>)</span> info b
</span></span><span class=line><span class=cl>Num     Type           Disp Enb Address            What
</span></span><span class=line><span class=cl><span class=m>1</span>       breakpoint     keep y   0x0000000000013779 in ig_hex_dump at zns_cli.c:265
</span></span></code></pre></td></tr></table></div></div><p>删除断点：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=o>(</span>gdb<span class=o>)</span> delete <span class=m>1</span>
</span></span></code></pre></td></tr></table></div></div><p>默认delete（不带参数）会删除所有断点。</p><p><a href=https://stackoverflow.com/questions/59599200/clear-all-breakpoints-in-gdb rel=noopener>https://stackoverflow.com/questions/59599200/clear-all-breakpoints-in-gdb</a></p><hr><p>带条件的断点：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=o>(</span>gdb<span class=o>)</span> <span class=nb>break</span> file1.c:6 <span class=k>if</span> i &gt;<span class=o>=</span> ARRAYSIZE
</span></span></code></pre></td></tr></table></div></div><h2 id=continue>continue</h2><p>程序执行到断点后，会停顿。如果想要继续执行，使用命令<code>continue</code>。简写为<code>c</code>。</p><p>它会一直执行，直到遇到下一个断点。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=o>(</span>gdb<span class=o>)</span> <span class=k>continue</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=next>next</h2><p>只执行一条语句，函数调用会直接执行完毕，不会进入函数。简写为<code>n</code>。</p><h2 id=step>step</h2><p>单步执行，会进入调用函数。简写为<code>s</code>。</p><h2 id=print>print</h2><p>打印信息。简写为<code>p</code>。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># 打印变量值</span>
</span></span><span class=line><span class=cl><span class=o>(</span>gdb<span class=o>)</span> print my_var
</span></span><span class=line><span class=cl><span class=c1># 16进制打印</span>
</span></span><span class=line><span class=cl><span class=o>(</span>gdb<span class=o>)</span> print/x my_var
</span></span></code></pre></td></tr></table></div></div><p>支持的format：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>o - octal
</span></span><span class=line><span class=cl>x - hexadecimal
</span></span><span class=line><span class=cl>u - unsigned decimal
</span></span><span class=line><span class=cl>t - binary
</span></span><span class=line><span class=cl>f - floating point
</span></span><span class=line><span class=cl>a - address
</span></span><span class=line><span class=cl>c - char
</span></span><span class=line><span class=cl>s - string
</span></span></code></pre></td></tr></table></div></div><p>打印指针：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># 打印指针的值</span>
</span></span><span class=line><span class=cl><span class=o>(</span>gdb<span class=o>)</span> print/x my_pointer
</span></span><span class=line><span class=cl><span class=c1># 打印指针指向的对象</span>
</span></span><span class=line><span class=cl><span class=o>(</span>gdb<span class=o>)</span> print *my_pointer
</span></span></code></pre></td></tr></table></div></div><p>打印数组：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=o>(</span>gdb<span class=o>)</span> p *array<span class=o>[</span>index<span class=o>]</span>@len
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>(</span>gdb<span class=o>)</span> p/x *bytes@16
</span></span><span class=line><span class=cl><span class=nv>$8</span> <span class=o>=</span> <span class=o>{</span>0xb9, 0xd8, 0x49, 0x47, 0x0, 0xa0, 0x0, 0x6, 0x2, 0xa8, 0x49, 0x47, 0x0, 0xa0, 0x0, 0x7<span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>漂亮打印设置（要不然结构体成员都堆到一起去了）：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=o>(</span>gdb<span class=o>)</span> <span class=nb>set</span> print pretty on
</span></span></code></pre></td></tr></table></div></div><p>例子：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=o>(</span>gdb<span class=o>)</span> p/x *req
</span></span><span class=line><span class=cl><span class=nv>$13</span> <span class=o>=</span> <span class=o>{</span><span class=nv>buf</span> <span class=o>=</span> 0x2000003bf000, <span class=nv>bufsize</span> <span class=o>=</span> 0x4000, <span class=nv>bz</span> <span class=o>=</span> 0x4, <span class=nv>real_bz</span> <span class=o>=</span> 0x4, <span class=nv>lba</span> <span class=o>=</span> 0xa00008, <span class=nv>dif_ctx</span> <span class=o>=</span> <span class=o>{</span><span class=nv>block_size</span> <span class=o>=</span> 0x1000, <span class=nv>md_size</span> <span class=o>=</span> 0x8, <span class=nv>md_interleave</span> <span class=o>=</span> 0x0, <span class=nv>guard_interval</span> <span class=o>=</span> 0x0, <span class=nv>dif_type</span> <span class=o>=</span> 0x1,
</span></span><span class=line><span class=cl>    <span class=nv>dif_flags</span> <span class=o>=</span> 0x1c000000, <span class=nv>init_ref_tag</span> <span class=o>=</span> 0xa00008, <span class=nv>app_tag</span> <span class=o>=</span> 0x4947, <span class=nv>apptag_mask</span> <span class=o>=</span> 0xffff, <span class=nv>data_offset</span> <span class=o>=</span> 0x0, <span class=nv>ref_tag_offset</span> <span class=o>=</span> 0x0, <span class=nv>last_guard</span> <span class=o>=</span> 0x0, <span class=nv>guard_seed</span> <span class=o>=</span> 0x0, <span class=nv>remapped_init_ref_tag</span> <span class=o>=</span> 0x0<span class=o>}</span>,
</span></span><span class=line><span class=cl>  <span class=nv>md_buf</span> <span class=o>=</span> 0x2000003be000, <span class=nv>io_flags</span> <span class=o>=</span> 0x1c000000, <span class=nv>zone_seed</span> <span class=o>=</span> 0x75ce92465dd74136, <span class=nv>zns</span> <span class=o>=</span> 0x5555558dc4a0, <span class=nv>cmd</span> <span class=o>=</span> 0x7fffffffe270, <span class=nv>fill_config</span> <span class=o>=</span> <span class=o>{</span><span class=nv>qword</span> <span class=o>=</span> 0x0, <span class=o>{</span><span class=nv>fill_pattern</span> <span class=o>=</span> 0x0, <span class=nv>pad</span> <span class=o>=</span> <span class=o>{</span>0x0, 0x0, 0x0, 0x0,
</span></span><span class=line><span class=cl>        0x0, 0x0<span class=o>}</span>, <span class=nv>flag</span> <span class=o>=</span> 0x0<span class=o>}}}</span>
</span></span><span class=line><span class=cl><span class=o>(</span>gdb<span class=o>)</span> <span class=nb>set</span> print pretty on
</span></span><span class=line><span class=cl><span class=o>(</span>gdb<span class=o>)</span> p/x *req
</span></span><span class=line><span class=cl><span class=nv>$14</span> <span class=o>=</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=nv>buf</span> <span class=o>=</span> 0x2000003bf000,
</span></span><span class=line><span class=cl>  <span class=nv>bufsize</span> <span class=o>=</span> 0x4000,
</span></span><span class=line><span class=cl>  <span class=nv>bz</span> <span class=o>=</span> 0x4,
</span></span><span class=line><span class=cl>  <span class=nv>real_bz</span> <span class=o>=</span> 0x4,
</span></span><span class=line><span class=cl>  <span class=nv>lba</span> <span class=o>=</span> 0xa00008,
</span></span><span class=line><span class=cl>  <span class=nv>dif_ctx</span> <span class=o>=</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>block_size</span> <span class=o>=</span> 0x1000,
</span></span><span class=line><span class=cl>    <span class=nv>md_size</span> <span class=o>=</span> 0x8,
</span></span><span class=line><span class=cl>    <span class=nv>md_interleave</span> <span class=o>=</span> 0x0,
</span></span><span class=line><span class=cl>    <span class=nv>guard_interval</span> <span class=o>=</span> 0x0,
</span></span><span class=line><span class=cl>    <span class=nv>dif_type</span> <span class=o>=</span> 0x1,
</span></span><span class=line><span class=cl>    <span class=nv>dif_flags</span> <span class=o>=</span> 0x1c000000,
</span></span><span class=line><span class=cl>    <span class=nv>init_ref_tag</span> <span class=o>=</span> 0xa00008,
</span></span><span class=line><span class=cl>    <span class=nv>app_tag</span> <span class=o>=</span> 0x4947,
</span></span><span class=line><span class=cl>    <span class=nv>apptag_mask</span> <span class=o>=</span> 0xffff,
</span></span><span class=line><span class=cl>    <span class=nv>data_offset</span> <span class=o>=</span> 0x0,
</span></span><span class=line><span class=cl>    <span class=nv>ref_tag_offset</span> <span class=o>=</span> 0x0,
</span></span><span class=line><span class=cl>    <span class=nv>last_guard</span> <span class=o>=</span> 0x0,
</span></span><span class=line><span class=cl>    <span class=nv>guard_seed</span> <span class=o>=</span> 0x0,
</span></span><span class=line><span class=cl>    <span class=nv>remapped_init_ref_tag</span> <span class=o>=</span> 0x0
</span></span><span class=line><span class=cl>  <span class=o>}</span>,
</span></span><span class=line><span class=cl>  <span class=nv>md_buf</span> <span class=o>=</span> 0x2000003be000,
</span></span><span class=line><span class=cl>  <span class=nv>io_flags</span> <span class=o>=</span> 0x1c000000,
</span></span><span class=line><span class=cl>  <span class=nv>zone_seed</span> <span class=o>=</span> 0x75ce92465dd74136,
</span></span><span class=line><span class=cl>  <span class=nv>zns</span> <span class=o>=</span> 0x5555558dc4a0,
</span></span><span class=line><span class=cl>  <span class=nv>cmd</span> <span class=o>=</span> 0x7fffffffe270,
</span></span><span class=line><span class=cl>  <span class=nv>fill_config</span> <span class=o>=</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>qword</span> <span class=o>=</span> 0x0,
</span></span><span class=line><span class=cl>    <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=nv>fill_pattern</span> <span class=o>=</span> 0x0,
</span></span><span class=line><span class=cl>      <span class=nv>pad</span> <span class=o>=</span> <span class=o>{</span>0x0, 0x0, 0x0, 0x0, 0x0, 0x0<span class=o>}</span>,
</span></span><span class=line><span class=cl>      <span class=nv>flag</span> <span class=o>=</span> 0x0
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=watch>watch</h2><p>跟踪变量被修改。</p><p><a href=https://www.cse.unsw.edu.au/~learn/debugging/modules/gdb_watch_display/ rel=noopener>https://www.cse.unsw.edu.au/~learn/debugging/modules/gdb_watch_display/</a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=o>(</span>gdb<span class=o>)</span> watch &lt;variable_name&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>(</span>gdb<span class=o>)</span> info breakpoints
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>(</span>gdb<span class=o>)</span> disable &lt;watchpoint_number&gt;
</span></span></code></pre></td></tr></table></div></div><p>观察内存地址对应的内容：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=o>(</span>gdb<span class=o>)</span> watch *0x10793ad0
</span></span></code></pre></td></tr></table></div></div><h2 id=backtrace>backtrace</h2><p>打印程序崩溃时的调用栈。简写为<code>bt</code>。</p><p><a href=https://sourceware.org/gdb/onlinedocs/gdb/Backtrace.html rel=noopener>https://sourceware.org/gdb/onlinedocs/gdb/Backtrace.html</a></p><hr><h2 id=stack-frame>stack frame</h2><p>切换stack frame：https://sourceware.org/gdb/onlinedocs/gdb/Selection.html</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>frame <span class=o>[</span> frame-selection-spec <span class=o>]</span>
</span></span><span class=line><span class=cl>f <span class=o>[</span> frame-selection-spec <span class=o>]</span>
</span></span></code></pre></td></tr></table></div></div><p>比如：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=o>(</span>gdb<span class=o>)</span> frame <span class=m>3</span>
</span></span><span class=line><span class=cl><span class=o>(</span>gdb<span class=o>)</span> frame level <span class=m>3</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>[!cite]+</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>up n
</span></span></code></pre></td></tr></table></div></div><p>Move n frames up the stack; n defaults to 1. For positive numbers n, this advances toward the outermost frame, to higher frame numbers, to frames that have existed longer.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>down n
</span></span></code></pre></td></tr></table></div></div><p>Move n frames down the stack; n defaults to 1. For positive numbers n, this advances toward the innermost frame, to lower frame numbers, to frames that were created more recently. You may abbreviate <code>down</code> as <code>do</code>.</p></blockquote><h2 id=反汇编>反汇编</h2><p>objdump工具。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>arm-none-eabi-objdump -dS main1.elf &gt; main1.asm
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>0000d324 &lt;memcpy&gt;:
</span></span><span class=line><span class=cl>    d324:	1e43      	subs	r3, r0, #1
</span></span><span class=line><span class=cl>    d326:	440a      	add	r2, r1
</span></span><span class=line><span class=cl>    d328:	b510      	push	{r4, lr}
</span></span><span class=line><span class=cl>    d32a:	4291      	cmp	r1, r2
</span></span><span class=line><span class=cl>    d32c:	d100      	bne.n	d330 &lt;memcpy+0xc&gt;
</span></span><span class=line><span class=cl>    d32e:	bd10      	pop	{r4, pc}
</span></span><span class=line><span class=cl>    d330:	f811 4b01 	ldrb.w	r4, [r1], #1
</span></span><span class=line><span class=cl>    d334:	f803 4f01 	strb.w	r4, [r3, #1]!
</span></span><span class=line><span class=cl>    d338:	e7f7      	b.n	d32a &lt;memcpy+0x6&gt;
</span></span></code></pre></td></tr></table></div></div><p><code>-T</code>可以加上符号表，包括文件里的static变量。</p><h2 id=修改内存打印内存>修改内存/打印内存</h2><p>打印内存：</p><p><a href=https://sourceware.org/gdb/current/onlinedocs/gdb/Memory.html rel=noopener>https://sourceware.org/gdb/current/onlinedocs/gdb/Memory.html</a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>x</span><span class=o>/</span><span class=n>nfu</span> <span class=n>addr</span>
</span></span><span class=line><span class=cl><span class=n>x</span> <span class=n>addr</span>
</span></span><span class=line><span class=cl><span class=n>x</span>
</span></span><span class=line><span class=cl><span class=n>Use</span> <span class=n>the</span> <span class=n>x</span> <span class=n>command</span> <span class=n>to</span> <span class=n>examine</span> <span class=n>memory</span><span class=p>.</span>
</span></span></code></pre></td></tr></table></div></div><p>例子：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=p>(</span><span class=n>gdb</span><span class=p>)</span> <span class=n>x</span><span class=o>/</span><span class=mi>16</span> <span class=mh>0xa1fa0</span>
</span></span><span class=line><span class=cl><span class=mh>0xa1fa0</span> <span class=o>&lt;</span><span class=n>btn_wd_uptd0</span><span class=o>&gt;:</span> <span class=mh>0x7f140bc0</span>      <span class=mh>0x00000000</span>     <span class=mh>0x80141fb8</span>      <span class=mh>0x000a0bc0</span>
</span></span><span class=line><span class=cl><span class=mh>0xa1fb0</span> <span class=o>&lt;</span><span class=n>btn_wd_uptd0</span><span class=o>+</span><span class=mi>16</span><span class=o>&gt;:</span>      <span class=mh>0xc0010160</span>    <span class=mh>0x00000000</span>       <span class=mh>0x00000000</span>      <span class=mh>0x00000000</span>
</span></span><span class=line><span class=cl><span class=mh>0xa1fc0</span> <span class=o>&lt;</span><span class=n>btn_wd_uptd1</span><span class=o>&gt;:</span> <span class=mh>0x7f140dc0</span>      <span class=mh>0x00000000</span>     <span class=mh>0x80141fd8</span>      <span class=mh>0x000a0dc0</span>
</span></span><span class=line><span class=cl><span class=mh>0xa1fd0</span> <span class=o>&lt;</span><span class=n>btn_wd_uptd1</span><span class=o>+</span><span class=mi>16</span><span class=o>&gt;:</span>      <span class=mh>0xc00101b4</span>    <span class=mh>0x00000000</span>       <span class=mh>0x00000000</span>      <span class=mh>0x00000000</span>
</span></span></code></pre></td></tr></table></div></div><hr><p>修改内存或变量：</p><p><a href=https://sourceware.org/gdb/current/onlinedocs/gdb/Assignment.html#Assignment rel=noopener>https://sourceware.org/gdb/current/onlinedocs/gdb/Assignment.html#Assignment</a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=p>(</span><span class=n>gdb</span><span class=p>)</span> <span class=n>set</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=n>gdb</span><span class=p>)</span> <span class=n>p</span> <span class=n>i</span>
</span></span><span class=line><span class=cl><span class=err>$</span><span class=mi>1</span> <span class=o>=</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=n>gdb</span><span class=p>)</span> <span class=n>p</span> <span class=o>&amp;</span><span class=n>i</span>
</span></span><span class=line><span class=cl><span class=err>$</span><span class=mi>2</span> <span class=o>=</span> <span class=p>(</span><span class=kt>int</span> <span class=o>*</span><span class=p>)</span> <span class=mh>0xbfbb0000</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=n>gdb</span><span class=p>)</span> <span class=n>set</span> <span class=o>*</span><span class=p>((</span><span class=kt>int</span> <span class=o>*</span><span class=p>)</span> <span class=mh>0xbfbb0000</span><span class=p>)</span> <span class=o>=</span> <span class=mi>20</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=n>gdb</span><span class=p>)</span> <span class=n>p</span> <span class=n>i</span>
</span></span><span class=line><span class=cl><span class=err>$</span><span class=mi>3</span> <span class=o>=</span> <span class=mi>20</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=dump内存到文件>dump内存到文件</h2><p>例子：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>dump memory vcd_raw.bin vcd_buffer (u32)vcd_buffer+sizeof(*vcd_buffer)
</span></span></code></pre></td></tr></table></div></div><p>dump memory + 文件名 + 内存起始地址 + 内存结束地址</p><h2 id=更改寄存器内容>更改寄存器内容？</h2><p>使用set命令。参考后面的案例。</p><h2 id=直接执行函数>直接执行函数</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=o>(</span>gdb<span class=o>)</span> p nvmet_get_req<span class=o>()</span>
</span></span><span class=line><span class=cl><span class=nv>$2</span> <span class=o>=</span> <span class=o>(</span>req_t *<span class=o>)</span> 0x87498 &lt;_reqs&gt;
</span></span></code></pre></td></tr></table></div></div><blockquote><p>[!cite]+
given this prototyped C or C++ function with float parameters:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>float multiply (float v1, float v2) { return v1 * v2; }
</span></span></code></pre></td></tr></table></div></div><p>these calls are equivalent:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>(gdb) p (float) multiply (2.0f, 3.0f)
</span></span><span class=line><span class=cl>(gdb) p ((float (*) (float, float)) multiply) (2.0f, 3.0f)
</span></span></code></pre></td></tr></table></div></div></blockquote><h2 id=tips>TIPS</h2><h3 id=脚本自动执行>脚本自动执行</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ cat djiang.gdb.1
</span></span><span class=line><span class=cl><span class=nb>set</span> pagination off
</span></span><span class=line><span class=cl><span class=nb>set</span> logging file ~/gdb.21.r5.log
</span></span><span class=line><span class=cl><span class=nb>set</span> logging on
</span></span><span class=line><span class=cl><span class=nb>set</span> trace-commands on
</span></span><span class=line><span class=cl>show logging
</span></span><span class=line><span class=cl>flush 
</span></span><span class=line><span class=cl>tar rem:2331
</span></span><span class=line><span class=cl>mon mww 0xc0204000 0xf
</span></span></code></pre></td></tr></table></div></div><p>使用方式：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>gdb-multiarch --batch -x djiang.gdb.3 main3
</span></span></code></pre></td></tr></table></div></div><h2 id=退出不要确认>退出不要确认</h2><p><a href=https://stackoverflow.com/questions/4355978/get-rid-of-quit-anyway-prompt-using-gdb-just-kill-the-process-and-quit rel=noopener>https://stackoverflow.com/questions/4355978/get-rid-of-quit-anyway-prompt-using-gdb-just-kill-the-process-and-quit</a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>set</span> <span class=n>confirm</span> <span class=n>off</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=案例>案例</h2><h3 id=sdpk程序单步执行>sdpk程序单步执行</h3><h3 id=spdk-crash-core分析>spdk crash core分析</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># gdb ./build/zns/zns_iocheck</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>(</span>gdb<span class=o>)</span> core core
</span></span><span class=line><span class=cl>Core was generated by <span class=sb>`</span>/home/root/workspace/spdk_zns_iocheck_Malloc/build/zns/zns_iocheck -m <span class=o>[</span>15<span class=o>]</span> -r M<span class=err>&#39;</span>.
</span></span><span class=line><span class=cl>Program terminated with signal SIGSEGV, Segmentation fault.
</span></span><span class=line><span class=cl><span class=c1>#0  spdk_accel_task_complete (accel_task=accel_task@entry=0x55a777da3288, status=status@entry=0) at accel_engine.c:130</span>
</span></span><span class=line><span class=cl><span class=m>130</span>                     batch-&gt;count--<span class=p>;</span>
</span></span><span class=line><span class=cl><span class=o>(</span>gdb<span class=o>)</span> bt
</span></span><span class=line><span class=cl><span class=c1>#0  spdk_accel_task_complete (accel_task=accel_task@entry=0x55a777da3288, status=status@entry=0) at accel_engine.c:130</span>
</span></span><span class=line><span class=cl><span class=c1>#1  0x000055a77739daa2 in spdk_accel_submit_copy (ch=ch@entry=0x55a777d7f850, dst=&lt;optimized out&gt;, src=src@entry=0x200035f45000, nbytes=&lt;optimized out&gt;, cb_fn=cb_fn@entry=0x55a777322600 &lt;malloc_done&gt;,</span>
</span></span><span class=line><span class=cl>    <span class=nv>cb_arg</span><span class=o>=</span>cb_arg@entry<span class=o>=</span>0x200009246468<span class=o>)</span> at accel_engine.c:209
</span></span><span class=line><span class=cl><span class=c1>#2  0x000055a7773227f8 in bdev_malloc_readv (mdisk=&lt;optimized out&gt;, offset=&lt;optimized out&gt;, len=&lt;optimized out&gt;, iovcnt=&lt;optimized out&gt;, iov=&lt;optimized out&gt;, task=0x200009246468, ch=0x55a777d7f850)</span>
</span></span><span class=line><span class=cl>    at bdev_malloc.c:159
</span></span><span class=line><span class=cl><span class=c1>#3  _bdev_malloc_submit_request (bdev_io=&lt;optimized out&gt;, ch=0x55a777d7f850) at bdev_malloc.c:251</span>
</span></span><span class=line><span class=cl><span class=c1>#4  bdev_malloc_submit_request (ch=0x55a777d7f850, bdev_io=&lt;optimized out&gt;) at bdev_malloc.c:319</span>
</span></span><span class=line><span class=cl><span class=c1>#5  0x000055a777396dee in bdev_io_do_submit (bdev_io=&lt;optimized out&gt;, bdev_ch=&lt;optimized out&gt;) at bdev.c:1901</span>
</span></span><span class=line><span class=cl><span class=c1>#6  _bdev_io_submit (ctx=&lt;optimized out&gt;) at bdev.c:2398</span>
</span></span><span class=line><span class=cl><span class=c1>#7  bdev_io_submit (bdev_io=0x200009246100) at bdev.c:2515</span>
</span></span><span class=line><span class=cl><span class=c1>#8  0x000055a777397bbe in bdev_read_blocks_with_md (desc=0x55a777c1c7f0, ch=0x55a777dc15c0, buf=0x200011a7a540, md_buf=md_buf@entry=0x0, offset_blocks=130373, num_blocks=1,</span>
</span></span><span class=line><span class=cl>    <span class=nv>cb</span><span class=o>=</span>0x55a7773211d0 &lt;ig_do_single_io_read_complete&gt;, <span class=nv>cb_arg</span><span class=o>=</span>0x55a777dc9cb8<span class=o>)</span> at bdev.c:3664
</span></span><span class=line><span class=cl><span class=c1>#9  0x000055a777397bfb in spdk_bdev_read_blocks (desc=&lt;optimized out&gt;, ch=&lt;optimized out&gt;, buf=&lt;optimized out&gt;, offset_blocks=&lt;optimized out&gt;, num_blocks=&lt;optimized out&gt;,</span>
</span></span><span class=line><span class=cl>    <span class=nv>cb</span><span class=o>=</span>cb@entry<span class=o>=</span>0x55a7773211d0 &lt;ig_do_single_io_read_complete&gt;, <span class=nv>cb_arg</span><span class=o>=</span>0x55a777dc9cb8<span class=o>)</span> at bdev.c:3688
</span></span><span class=line><span class=cl><span class=c1>#10 0x000055a77731f20d in ig_do_single_io_read (ctx=0x55a777dc9cb8, task=0x55a777dbad00) at io_engine.c:521</span>
</span></span><span class=line><span class=cl><span class=c1>#11 ig_io_issue_read (ctx=0x55a777dc9cb8, task=0x55a777dbad00) at io_engine.c:294</span>
</span></span><span class=line><span class=cl><span class=c1>#12 ig_io_issue (ctx=0x55a777dc9cb8, task=0x55a777dbad00) at io_engine.c:201</span>
</span></span><span class=line><span class=cl><span class=c1>#13 ig_do_single_io (task=0x55a777dbad00, ctx=0x55a777dc9cb8) at io_engine.c:105</span>
</span></span><span class=line><span class=cl><span class=c1>#14 0x000055a777321413 in ig_do_single_io_read_complete (bdev_io=&lt;optimized out&gt;, success=&lt;optimized out&gt;, cb_arg=0x55a777dc9cb8) at io_engine.c:599</span>
</span></span><span class=line><span class=cl><span class=c1>#15 0x000055a7773a6686 in msg_queue_run_batch (max_msgs=&lt;optimized out&gt;, thread=0x55a777dbe8b0) at thread.c:544</span>
</span></span><span class=line><span class=cl><span class=c1>#16 thread_poll (thread=thread@entry=0x55a777dbe8b0, max_msgs=max_msgs@entry=0, now=now@entry=7684914257947836) at thread.c:623</span>
</span></span><span class=line><span class=cl><span class=c1>#17 0x000055a7773a7300 in spdk_thread_poll (thread=thread@entry=0x55a777dbe8b0, max_msgs=max_msgs@entry=0, now=7684914257947836) at thread.c:733</span>
</span></span><span class=line><span class=cl><span class=c1>#18 0x000055a7773a2919 in _reactor_run (reactor=0x55a777d75cc0) at reactor.c:906</span>
</span></span><span class=line><span class=cl><span class=c1>#19 reactor_run (arg=0x55a777d75cc0) at reactor.c:944</span>
</span></span><span class=line><span class=cl><span class=c1>#20 0x000055a7773a2c97 in spdk_reactors_start () at reactor.c:1052</span>
</span></span><span class=line><span class=cl><span class=c1>#21 0x000055a77739fbcc in spdk_app_start (opts_user=&lt;optimized out&gt;, start_fn=0x55a77731ca80 &lt;zns_iocheck_start&gt;, arg1=0x0) at app.c:577</span>
</span></span><span class=line><span class=cl><span class=c1>#22 0x000055a77731818c in main (argc=5, argv=0x7fffd56acf58) at zns_iocheck.c:1024</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=固件现场恢复>固件现场恢复</h3><p>固件crash打印的信息（ARM32）：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>cpu1: 00040F5F A rtos/src/rtos.c +504 exception_handler<span class=o>()</span> - <span class=o>===</span>&gt; Kernel CRASH!!!
</span></span><span class=line><span class=cl>cpu1: Exception: data abort 001855BE
</span></span><span class=line><span class=cl>cpu1: R<span class=o>[</span>0<span class=o>]</span>: 00040F5F R<span class=o>[</span>1<span class=o>]</span>: <span class=m>20055440</span>
</span></span><span class=line><span class=cl>cpu1: R<span class=o>[</span>2<span class=o>]</span>: 000000D9 R<span class=o>[</span>3<span class=o>]</span>: <span class=m>00089698</span>
</span></span><span class=line><span class=cl>cpu1: R<span class=o>[</span>4<span class=o>]</span>: <span class=m>20055440</span> R<span class=o>[</span>5<span class=o>]</span>: <span class=m>20055440</span>
</span></span><span class=line><span class=cl>cpu1: R<span class=o>[</span>6<span class=o>]</span>: 0008ACD0 R<span class=o>[</span>7<span class=o>]</span>: <span class=m>00192930</span>
</span></span><span class=line><span class=cl>cpu1: R<span class=o>[</span>8<span class=o>]</span>: <span class=m>00000001</span> R<span class=o>[</span>9<span class=o>]</span>: 000000BD
</span></span><span class=line><span class=cl>cpu1: R<span class=o>[</span>10<span class=o>]</span>: 000AD95C R<span class=o>[</span>11<span class=o>]</span>: <span class=m>00000000</span>
</span></span><span class=line><span class=cl>cpu1: R<span class=o>[</span>12<span class=o>]</span>: <span class=m>00000001</span> R<span class=o>[</span>13<span class=o>]</span>: 000AED38
</span></span><span class=line><span class=cl>cpu1: R<span class=o>[</span>14<span class=o>]</span> 0018888F CPSR: <span class=m>00000197</span>
</span></span></code></pre></td></tr></table></div></div><p>data abort指向的是$PC=0x001855BE；</p><p>R13对应的是SP寄存器；</p><p>R14对应的是LR寄存器（function return address）。</p><p>恢复现场：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=o>(</span>gdb<span class=o>)</span> <span class=nb>set</span> <span class=nv>$sp</span><span class=o>=</span>0x000AED38
</span></span><span class=line><span class=cl><span class=o>(</span>gdb<span class=o>)</span> <span class=nb>set</span> <span class=nv>$lr</span><span class=o>=</span>0x0018888F
</span></span><span class=line><span class=cl><span class=o>(</span>gdb<span class=o>)</span> <span class=nb>set</span> <span class=nv>$pc</span><span class=o>=</span>0x001855BE
</span></span><span class=line><span class=cl><span class=o>(</span>gdb<span class=o>)</span> bt
</span></span><span class=line><span class=cl><span class=c1>#0  0x001855be in nvmet_get_req () at /home/lzy/tacoma-clean/nvme/src/nvme_ctrl/nvme_core.c:200</span>
</span></span><span class=line><span class=cl><span class=c1>#1  0x0018888e in nvmet_rx_handle_cmd (sqid=494414, cmd=0x1 &lt;_start&gt;, nvm_cmd_id=2, rx_cmd=0x2f &lt;do_exception+6&gt;, fun_id=40 &#39;(&#39;) at /home/lzy/tacoma-clean/nvme/src/nvme_ctrl/nvme_io_cmd.c:777</span>
</span></span><span class=line><span class=cl><span class=c1>#2  0x2b2929a0 in ?? ()</span>
</span></span><span class=line><span class=cl>Backtrace stopped: previous frame identical to this frame <span class=o>(</span>corrupt stack?<span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=资源>资源</h2><ul><li><a href=/quartz/wiki/wiki/bash/gdbgui rel=noopener class=internal-link data-src=/quartz/wiki/wiki/bash/gdbgui>gdbgui</a></li></ul><ul><li>cgdb？关注</li><li><a href=https://blog.csdn.net/zdy0_2004/article/details/80102076 rel=noopener>gdb调试的基本使用</a></li><li><a href=https://www.cs.umd.edu/~srhuang/teaching/cmsc212/gdb-tutorial-handout.pdf rel=noopener>gdb-tutorial-handout.pdf</a></li><li><a href=https://www.techbeamers.com/how-to-use-gdb-top-debugging-tips/ rel=noopener>GDB Tutorial: Essential GDB Tips to Learn Debugging</a></li><li><a href=http://visualgdb.com/gdbreference/commands/ rel=noopener>GDB Command Reference</a></li></ul><hr><blockquote><p>[!faq]+ Missing separate debuginfos</p><p><a href=https://access.redhat.com/solutions/1506273 rel=noopener>Why gdb is showing message &ldquo;Missing separate debuginfos&rdquo;? - Red Hat Customer Portal</a></p><p>照提示安装即可。</p></blockquote></article><hr><div class=page-end><div class=backlinks-container><h3>Backlinks</h3><ul class=backlinks><li>No backlinks found</li></ul></div></div><div id=contact_buttons><footer><p>Made by Jacky Zhao using <a href=https://github.com/jackyzha0/quartz>Quartz</a>, © 2022</p><ul><li><a href=/>Home</a></li><li><a href=https://twitter.com/_jzhao>Twitter</a></li><li><a href=https://github.com/jackyzha0>Github</a></li></ul></footer></div><script src=https://lzyerste.github.io/quartz/js/popover.e57188d2e4c06b0654e020b3a734bb62.min.js></script>
<script>initPopover("https://lzyerste.github.io/quartz")</script></div></body></html>